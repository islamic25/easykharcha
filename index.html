<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>Register – EasyKharcha</title>

<!-- icons + font -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
/* ---------- tokens ---------- */
:root {
  --primary: #1a73e8;
  --primary-dark: #0d47a1;
  --primary-light: #e8f0fe;
  --gray: #5f6368;
  --light-gray: #dadce0;
  --lighter-gray: #f8f9fa;
  --success: #34a853;
  --success-light: #e8f5e9;
  --error: #ea4335;
  --error-light: #fce8e6;
  --warning: #f9ab00;
  --shadow: 0 4px 12px rgba(0,0,0,.08);
  --transition: all 0.3s ease;
  --border-radius: 14px;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, #f5f7fa, #e4edf5);
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  color: #202124;
  line-height: 1.6;
}

.container {
  display: flex;
  max-width: 1200px;
  width: 100%;
  background: #fff;
  border-radius: var(--border-radius);
  overflow: hidden;
  box-shadow: var(--shadow);
  position: relative;
  min-height: 700px;
}

.illustration {
  flex: 1;
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px;
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: #fff;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.illustration::before {
  content: "";
  position: absolute;
  top: -50px;
  right: -50px;
  width: 150px;
  height: 150px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
}

.illustration::after {
  content: "";
  position: absolute;
  bottom: -30px;
  left: -30px;
  width: 100px;
  height: 100px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
}

@media(min-width:992px) {
  .illustration {
    display: flex;
  }
}

.illustration-content {
  position: relative;
  z-index: 2;
  max-width: 80%;
}

.illustration h2 {
  font-size: 32px;
  margin-bottom: 20px;
  font-weight: 700;
}

.illustration p {
  font-size: 18px;
  opacity: 0.9;
  margin-bottom: 30px;
}

.features {
  text-align: left;
  margin-top: 30px;
  width: 100%;
}

.feature-item {
  display: flex;
  align-items: center;
  margin-bottom: 20px;
  font-size: 16px;
}

.feature-item i {
  margin-right: 15px;
  font-size: 20px;
  color: rgba(255, 255, 255, 0.8);
}

.register {
  flex: 1;
  padding: 40px;
  position: relative;
  overflow-y: auto;
}

.logo {
  display: flex;
  align-items: center;
  margin-bottom: 30px;
}

.logo-icon {
  width: 50px;
  height: 50px;
  border-radius: 12px;
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: var(--shadow);
}

.logo-icon i {
  color: #fff;
  font-size: 24px;
}

.logo-text {
  font-size: 24px;
  font-weight: 700;
  margin-left: 15px;
}

.logo-text span {
  color: var(--primary);
}

.header {
  margin-bottom: 30px;
}

.header h1 {
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 5px;
}

.header p {
  color: var(--gray);
  font-size: 16px;
}

.form-group {
  margin-bottom: 25px;
  position: relative;
}

.form-group label {
  display: block;
  font-size: 14px;
  font-weight: 500;
  margin-bottom: 8px;
}

.input-with-icon {
  position: relative;
}

.input-with-icon i {
  position: absolute;
  left: 15px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--gray);
  transition: var(--transition);
}

input {
  width: 100%;
  padding: 16px 16px 16px 48px;
  border: 2px solid var(--light-gray);
  border-radius: 12px;
  font-size: 16px;
  font-family: 'Poppins', sans-serif;
  transition: var(--transition);
  background: var(--lighter-gray);
}

input:focus {
  border-color: var(--primary);
  outline: 0;
  box-shadow: 0 0 0 3px rgba(26,115,232,.1);
  background: #fff;
}

input:focus + i {
  color: var(--primary);
}

input.readonly {
  background: #f0f0f0;
  cursor: not-allowed;
}

.error {
  color: var(--error);
  font-size: 13px;
  margin-top: 6px;
  display: none;
  padding-left: 5px;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-5px); }
  to { opacity: 1; transform: translateY(0); }
}

.password-toggle {
  position: absolute;
  right: 15px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  cursor: pointer;
  color: var(--gray);
  transition: var(--transition);
  z-index: 10;
}

.password-toggle:hover {
  color: var(--primary);
}

.password-strength {
  height: 4px;
  background: var(--light-gray);
  border-radius: 2px;
  margin-top: 8px;
  overflow: hidden;
}

.password-strength-bar {
  height: 4px;
  width: 0;
  background: var(--error);
  transition: width 0.3s ease;
}

.password-strength-text {
  font-size: 12px;
  margin-top: 4px;
  color: var(--gray);
}

.btn {
  width: 100%;
  padding: 16px;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  color: #fff;
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition);
  font-family: 'Poppins', sans-serif;
  box-shadow: 0 4px 10px rgba(26, 115, 232, 0.25);
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 15px rgba(26, 115, 232, 0.35);
}

.btn:active {
  transform: translateY(1px);
}

.btn i {
  margin-right: 10px;
}

#loader {
  position: fixed;
  inset: 0;
  background: rgba(255, 255, 255, 0.9);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  transition: opacity .3s;
}

#loader.hidden {
  opacity: 0;
  pointer-events: none;
}

#loader .spinner {
  width: 48px;
  height: 48px;
  border: 5px solid #e0e0e0;
  border-top-color: var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 20px;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* success banner */
.invite-success {
  display: none;
  background: var(--success-light);
  border-left: 4px solid var(--success);
  padding: 12px 15px;
  border-radius: 0 8px 8px 0;
  margin-bottom: 20px;
  font-size: 14px;
  color: #155724;
  align-items: center;
  animation: slideIn 0.3s ease;
}

@keyframes slideIn {
  from { opacity: 0; transform: translateX(-20px); }
  to { opacity: 1; transform: translateX(0); }
}

.invite-success i {
  margin-right: 8px;
  color: var(--success);
}

.terms-container {
  display: flex;
  align-items: flex-start;
  margin-top: 10px;
}

.terms-container input {
  width: auto;
  margin-top: 4px;
  margin-right: 10px;
  min-height: 20px;
  min-width: 20px;
}

.terms-container label {
  display: inline;
  font-weight: 400;
  font-size: 14px;
  color: var(--gray);
  cursor: pointer;
  line-height: 1.4;
}

.terms-container a {
  color: var(--primary);
  text-decoration: none;
  font-weight: 500;
}

.terms-container a:hover {
  text-decoration: underline;
}

.login-link {
  text-align: center;
  margin-top: 25px;
  font-size: 14px;
  color: var(--gray);
}

.login-link a {
  color: var(--primary);
  text-decoration: none;
  font-weight: 500;
  margin-left: 5px;
}

.login-link a:hover {
  text-decoration: underline;
}

.strength-indicator {
  display: flex;
  gap: 5px;
  margin-top: 8px;
}

.strength-bar {
  height: 4px;
  flex: 1;
  background: var(--light-gray);
  border-radius: 2px;
  transition: all 0.3s ease;
}

.secure-note {
  font-size: 12px;
  color: var(--gray);
  margin-top: 5px;
  display: flex;
  align-items: center;
}

.secure-note i {
  margin-right: 5px;
  color: var(--success);
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .container {
    flex-direction: column;
    min-height: auto;
    border-radius: 16px;
  }
  
  .register {
    padding: 30px 20px;
  }
  
  .header h1 {
    font-size: 24px;
  }
  
  input {
    padding: 14px 14px 14px 45px;
    font-size: 15px;
  }
  
  .logo {
    margin-bottom: 20px;
  }
  
  .logo-icon {
    width: 40px;
    height: 40px;
  }
  
  .logo-text {
    font-size: 20px;
  }
  
  .btn {
    padding: 14px;
    font-size: 15px;
  }
  
  .form-group {
    margin-bottom: 20px;
  }
}

@media (max-width: 480px) {
  body {
    padding: 10px;
    background: #fff;
  }
  
  .container {
    box-shadow: none;
    min-height: 100vh;
  }
  
  .register {
    padding: 25px 15px;
  }
  
  .header h1 {
    font-size: 22px;
  }
  
  .header p {
    font-size: 14px;
  }
  
  input {
    padding: 12px 12px 12px 42px;
  }
  
  .logo-icon {
    width: 36px;
    height: 36px;
    border-radius: 10px;
  }
  
  .logo-icon i {
    font-size: 20px;
  }
  
  .logo-text {
    font-size: 18px;
  }
  
  .terms-container label {
    font-size: 13px;
  }
}

/* Success state */
.success-state {
  display: none;
  text-align: center;
  padding: 30px;
  animation: fadeIn 0.5s ease;
}

.success-state i {
  font-size: 60px;
  color: var(--success);
  margin-bottom: 20px;
  animation: popIn 0.5s ease;
}

@keyframes popIn {
  0% { transform: scale(0.5); opacity: 0; }
  70% { transform: scale(1.1); }
  100% { transform: scale(1); opacity: 1; }
}

.success-state h2 {
  font-size: 24px;
  margin-bottom: 15px;
}

.success-state p {
  color: var(--gray);
  margin-bottom: 25px;
  line-height: 1.6;
}

.success-state .btn {
  max-width: 250px;
  margin: 0 auto;
}

/* Mobile header */
.mobile-header {
  display: none;
  text-align: center;
  margin-bottom: 25px;
  padding-top: 10px;
}

.mobile-header h2 {
  font-size: 18px;
  color: var(--primary);
  font-weight: 600;
}

@media (max-width: 768px) {
  .mobile-header {
    display: block;
  }
}

/* Input validation states */
.input-valid {
  border-color: #34a853 !important;
}

.input-invalid {
  border-color: #ea4335 !important;
}

/* Password tips */
.password-tips {
  background: var(--lighter-gray);
  border-radius: 10px;
  padding: 12px;
  margin-top: 10px;
  font-size: 13px;
  display: none;
}

.password-tips ul {
  padding-left: 20px;
  margin-top: 5px;
}

.password-tips li {
  margin-bottom: 3px;
}

/* Focus state for accessibility */
input:focus, button:focus {
  outline: 2px solid var(--primary);
  outline-offset: 2px;
}

  .spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #004225;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  img {
  width: 150px;
  height: auto;
  display: block;
  margin: 20px auto;
}

</style>

</style>
</head>
<body>
<!-- 🔹 Splash screen -->
<div id="splashScreen" style="position:fixed;top:0;left:0;width:100%;height:100%;
background:#fff;display:flex;flex-direction:column;justify-content:center;align-items:center;
z-index:9999;transition:opacity 0.3s ease;">
  
  <!-- App Logo -->
  <img src="WhatsApp_Image_2025-07-17_at_9.59.22_PM-removebg-preview.png" alt="EasyKharcha Logo" style="width:80px;height:80px;margin-bottom:20px;" />

  <!-- App Name -->
  <h2 style="font-family:'Poppins',sans-serif;color:#004225;">Easy<span style="color:#d4af37;">Easy Kharcha</span></h2>

  <!-- Spinner -->
  <div class="spinner" style="margin-top: 20px;"></div>

</div>

<!-- loader -->
<div id="loader"><div class="spinner"></div><p>Creating your account...</p></div>

<div class="container">
  <!-- left side -->
  <div class="illustration">
    <div class="illustration-content">
      <h2>Track Expenses Effortlessly</h2>
      <p>Thousands of users manage expenses with EasyKharcha.</p>
      
      <div class="features">
        <div class="feature-item">
          <i class="fas fa-chart-pie"></i>
          <span>Visual expense breakdowns</span>
        </div>
        <div class="feature-item">
          <i class="fas fa-sync-alt"></i>
          <span>Real-time expense syncing</span>
        </div>
        <div class="feature-item">
          <i class="fas fa-shield-alt"></i>
          <span>Bank-level security</span>
        </div>
        <div class="feature-item">
          <i class="fas fa-mobile-alt"></i>
          <span>Mobile-friendly interface</span>
        </div>
      </div>
    </div>
  </div>

  <!-- form -->
  <div class="register">
    <div class="mobile-header">
      <h2>Track Expenses Anywhere</h2>
    </div>
    
    <div class="logo">
      <div class="logo-icon">
        <i class="fas fa-wallet"></i>
      </div>
      <div class="logo-text">Easy<span>Kharcha</span></div>
    </div>
    
    <div class="header">
      <h1>Create Account</h1>
      <p>Start managing your finances in minutes.</p>
    </div>

    <div class="invite-success" id="inviteSuccess">
      <i class="fas fa-gift"></i> Bonus applied via referral code!
    </div>

    <form id="registrationForm">
      <!-- Full Name -->
      <div class="form-group">
        <label for="fullname">Full Name</label>
        <div class="input-with-icon">
          <i class="fas fa-user"></i>
          <input type="text" id="fullname" placeholder="Full name" autocomplete="name">
        </div>
        <div class="error" id="name-error">Please enter your full name</div>
      </div>

      <!-- Biz -->
      <div class="form-group">
        <label for="business">Business Name</label>
        <div class="input-with-icon">
          <i class="fas fa-briefcase"></i>
          <input type="text" id="business" placeholder="Business name" autocomplete="organization">
        </div>
        <div class="error" id="biz-error">Please enter your business name</div>
      </div>

      <!-- Email -->
      <div class="form-group">
        <label for="email">Email</label>
        <div class="input-with-icon">
          <i class="fas fa-envelope"></i>
          <input type="email" id="email" placeholder="Email" autocomplete="email">
        </div>
        <div class="error" id="email-error">Please enter a valid email address</div>
      </div>

      <!-- Password -->
      <div class="form-group">
        <label for="password">Password</label>
        <div class="input-with-icon">
          <i class="fas fa-lock"></i>
          <input type="password" id="password" placeholder="Password" autocomplete="new-password">
          <button type="button" class="password-toggle" id="togglePw" aria-label="Toggle password visibility">
            <i class="fas fa-eye"></i>
          </button>
        </div>
        <div class="strength-indicator">
          <div class="strength-bar" id="strengthBar1"></div>
          <div class="strength-bar" id="strengthBar2"></div>
          <div class="strength-bar" id="strengthBar3"></div>
          <div class="strength-bar" id="strengthBar4"></div>
        </div>
        <div id="pwText" class="password-strength-text">Password strength: Very weak</div>
        <div class="password-tips" id="passwordTips">
          <strong>Tips for a strong password:</strong>
          <ul>
            <li>At least 8 characters</li>
            <li>Mix of uppercase and lowercase letters</li>
            <li>Include numbers and special characters</li>
            <li>Avoid common words or patterns</li>
          </ul>
        </div>
        <div class="error" id="pw-error">Password must be at least 8 characters</div>
      </div>

      <!-- Confirm -->
      <div class="form-group">
        <label for="confirm">Confirm Password</label>
        <div class="input-with-icon">
          <i class="fas fa-lock"></i>
          <input type="password" id="confirm" placeholder="Confirm password" autocomplete="new-password">
        </div>
        <div class="error" id="confirm-error">Passwords do not match</div>
      </div>

      <!-- Invite -->
      <div class="form-group" id="invite-box">
        <label for="invitationCode">Invitation Code <small style="font-weight:400;color:var(--gray)">(optional)</small></label>
        <div class="input-with-icon">
          <i class="fas fa-gift"></i>
          <input id="invitationCode" placeholder="Enter code" autocomplete="off">
        </div>
        <div class="error" id="invite-error">Invitation code not found</div>
      </div>

      <!-- terms -->
      <div class="form-group">
        <div class="terms-container">
          <input type="checkbox" id="terms">
          <label for="terms">I agree to the <a href="terms.html" tabindex="-1">Terms</a> & <a href="privacy.html" tabindex="-1">Privacy Policy</a></label>
        </div>
        <div class="error" id="terms-error">Please accept our terms and privacy policy</div>
      </div>

      <!-- sign up -->
      <button type="submit" class="btn" id="signup">
        <i class="fas fa-user-plus"></i> Create Account
      </button>
    </form>
    
    <div class="login-link">
      Already have an account? <a href="login.html">Log in</a>
    </div>
  </div>
  
  <!-- Success state (hidden initially) -->
  <div class="success-state" id="successState">
    <i class="fas fa-check-circle"></i>
    <h2>Account Created Successfully!</h2>
    <p>Your EasyKharcha account is ready to use. kindly click th login button and login your account</p>
   <button class="btn" id="dashboardBtn">
    <i class="fas fa-tachometer-alt"></i> Go to login page
  </button>

  </div>
</div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
 <script>

  /* 🔹 Firebase init */
  const firebaseConfig = {
    apiKey:            "AIzaSyDHGd2EAJVUUYXa50G65GkutoiiHz9qtn8",
    authDomain:        "easykharcha.firebaseapp.com",
    projectId:         "easykharcha",
    storageBucket:     "easykharcha.appspot.com",
    messagingSenderId: "735642025618",
    appId:             "1:735642025618:web:eacc16213b61c48c93f04b"
  };
  firebase.initializeApp(firebaseConfig);
  // ✅ Auth State Checker
    window.addEventListener('DOMContentLoaded', () => {
      firebase.auth().onAuthStateChanged((user) => {
        if (user) {
          // 👤 Already logged in - go to profile
          window.location.href = "profile.html";
        } else {
          // ❌ Not logged in - hide splash and show form
          document.getElementById("splashScreen").style.opacity = "0";
          setTimeout(() => {
            document.getElementById("splashScreen").style.display = "none";
            document.getElementById("registerForm").style.display = "block";
          }, 400);
        }
      });
    });
  const auth = firebase.auth();
  const db   = firebase.firestore();

document.addEventListener('DOMContentLoaded', () => {
  // DOM elements
  const loader = document.getElementById('loader');
  const form = document.getElementById('registrationForm');
  const inviteIn = document.getElementById('invitationCode');
  const successState = document.getElementById('successState');
  const toggleBtn = document.getElementById('togglePw');
  const pw = document.getElementById('password');
  const pw2 = document.getElementById('confirm');
  const signupBtn = document.getElementById('signup');
  const passwordTips = document.getElementById('passwordTips');
  
  // Auto-fill invite if link has ?ref
  const params = new URLSearchParams(location.search);
  const refCode = params.get('ref')?.toUpperCase() || null;
  
  if(refCode) {
    inviteIn.value = refCode;
    inviteIn.readOnly = true;
    inviteIn.classList.add('readonly');
    document.getElementById('inviteSuccess').style.display = 'flex';
  }
  
  // Toggle password visibility
  toggleBtn.onclick = () => {
    const type = pw.type === 'password' ? 'text' : 'password';
    pw.type = type;
    pw2.type = type;
    toggleBtn.innerHTML = type === 'password' 
      ? '<i class="fas fa-eye"></i>' 
      : '<i class="fas fa-eye-slash"></i>';
  };
  
  // Password strength with visual bars
  const strengthBars = [
    document.getElementById('strengthBar1'),
    document.getElementById('strengthBar2'),
    document.getElementById('strengthBar3'),
    document.getElementById('strengthBar4')
  ];
  
  pw.onfocus = () => {
    passwordTips.style.display = 'block';
  };
  
  pw.onblur = () => {
    passwordTips.style.display = 'none';
  };
  
  pw.oninput = () => {
    const v = pw.value;
    let strength = 0;
    
    // Length check
    if (v.length >= 8) strength += 25;
    
    // Lowercase and uppercase
    if (/[a-z]/.test(v) && /[A-Z]/.test(v)) strength += 25;
    
    // Numbers
    if (/\d/.test(v)) strength += 25;
    
    // Special characters
    if (/[!@#$%^&*?_~]/.test(v)) strength += 25;
    
    // Update bars
    const barCount = Math.floor(strength / 25);
    strengthBars.forEach((bar, index) => {
      if (index < barCount) {
        if (strength < 50) {
          bar.style.background = '#ea4335'; // Red
        } else if (strength < 75) {
          bar.style.background = '#f9ab00'; // Orange
        } else {
          bar.style.background = 'f#34a853'; // Green
        }
      } else {
        bar.style.background = '#dadce0'; // Gray
      }
    });
    
    // Update text
    const pwText = document.getElementById('pwText');
    if (strength < 25) {
      pwText.textContent = 'Password strength: Very weak';
      pwText.style.color = '#ea4335';
    } else if (strength < 50) {
      pwText.textContent = 'Password strength: Weak';
      pwText.style.color = '#ea4335';
    } else if (strength < 75) {
      pwText.textContent = 'Password strength: Medium';
      pwText.style.color = '#f9ab00';
    } else {
      pwText.textContent = 'Password strength: Strong';
      pwText.style.color = '#34a853';
    }
  };
  
  // Real-time validation
  const validateField = (field, type) => {
    const value = field.value.trim();
    const errorId = `${field.id}-error`;
    const errorElement = document.getElementById(errorId);
    
    // Hide error by default
    if (errorElement) errorElement.style.display = 'none';
    
    // Reset field styling
    field.classList.remove('input-valid', 'input-invalid');
    
    // Skip validation if field is empty
    if (!value) return;
    
    let isValid = false;
    
    switch(type) {
      case 'name':
        isValid = value.length >= 3;
        break;
      case 'email':
        isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
        break;
      case 'password':
        isValid = value.length >= 8;
        break;
      case 'confirm':
        isValid = value === pw.value;
        break;
      case 'business':
        isValid = value.length >= 2;
        break;
    }
    
    if (isValid) {
      field.classList.add('input-valid');
    } else {
      field.classList.add('input-invalid');
      if (errorElement) errorElement.style.display = 'block';
    }
  };
  
  // Attach validation to fields
  document.getElementById('fullname').addEventListener('blur', () => validateField(document.getElementById('fullname'), 'name'));
  document.getElementById('business').addEventListener('blur', () => validateField(document.getElementById('business'), 'business'));
  document.getElementById('email').addEventListener('blur', () => validateField(document.getElementById('email'), 'email'));
  pw.addEventListener('blur', () => validateField(pw, 'password'));
  pw2.addEventListener('blur', () => validateField(pw2, 'confirm'));
  
  // Form validation
  const validateForm = () => {
    let isValid = true;
    const name = document.getElementById('fullname').value.trim();
    const biz = document.getElementById('business').value.trim();
    const email = document.getElementById('email').value.trim();
    const pass = pw.value;
    const pass2 = pw2.value;
    const terms = document.getElementById('terms').checked;
    
    // Hide all errors first
    document.querySelectorAll('.error').forEach(e => e.style.display = 'none');
    
    // Validate name
    if (!name) {
      document.getElementById('name-error').style.display = 'block';
      isValid = false;
      document.getElementById('fullname').classList.add('input-invalid');
    } else {
      document.getElementById('fullname').classList.add('input-valid');
    }
    
    // Validate business
    if (!biz) {
      document.getElementById('biz-error').style.display = 'block';
      isValid = false;
      document.getElementById('business').classList.add('input-invalid');
    } else {
      document.getElementById('business').classList.add('input-valid');
    }
    
    // Validate email
    if (!email) {
      document.getElementById('email-error').textContent = 'Please enter your email';
      document.getElementById('email-error').style.display = 'block';
      isValid = false;
      document.getElementById('email').classList.add('input-invalid');
    } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      document.getElementById('email-error').textContent = 'Please enter a valid email address';
      document.getElementById('email-error').style.display = 'block';
      isValid = false;
      document.getElementById('email').classList.add('input-invalid');
    } else {
      document.getElementById('email').classList.add('input-valid');
    }
    
    // Validate password
    if (!pass) {
      document.getElementById('pw-error').textContent = 'Please enter a password';
      document.getElementById('pw-error').style.display = 'block';
      isValid = false;
      pw.classList.add('input-invalid');
    } else if (pass.length < 8) {
      document.getElementById('pw-error').textContent = 'Password must be at least 8 characters';
      document.getElementById('pw-error').style.display = 'block';
      isValid = false;
      pw.classList.add('input-invalid');
    } else {
      pw.classList.add('input-valid');
    }
    
    // Validate password match
    if (!pass2) {
      document.getElementById('confirm-error').textContent = 'Please confirm your password';
      document.getElementById('confirm-error').style.display = 'block';
      isValid = false;
      pw2.classList.add('input-invalid');
    } else if (pass !== pass2) {
      document.getElementById('confirm-error').textContent = 'Passwords do not match';
      document.getElementById('confirm-error').style.display = 'block';
      isValid = false;
      pw2.classList.add('input-invalid');
    } else {
      pw2.classList.add('input-valid');
    }
    
    // Validate terms
    if (!terms) {
      document.getElementById('terms-error').style.display = 'block';
      isValid = false;
    }
    
    return isValid;
  };
  // 🔧 Generate Unique 6-character Referral Code
function generateReferralCode(length = 6) {
  const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  let code = "";
  for (let i = 0; i < length; i++) {
    code += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return code;
}

  // Form submission
  form.onsubmit = async (e) => {
  e.preventDefault();

  if (!validateForm()) return;

  // Disable btn and show loader
  const oldHTML = signupBtn.innerHTML;
  signupBtn.disabled = true;
  signupBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Account...';
  loader.classList.remove('hidden');

  try {
    const name = document.getElementById('fullname').value.trim();
    const biz  = document.getElementById('business').value.trim();
    const email = document.getElementById('email').value.trim();
    const pass = document.getElementById('password').value;
    const inviteCode = document.getElementById('invitationCode').value.trim();

    const userCredential = await auth.createUserWithEmailAndPassword(email, pass);
    const user = userCredential.user;

    // 🔎 1. Check referral
    let invitedByUid = null;
    if (inviteCode) {
      const refQuery = await db.collection("users")
        .where("referralCode", "==", inviteCode)
        .limit(1)
        .get();

      if (!refQuery.empty) {
        const refDoc = refQuery.docs[0];
        invitedByUid = refDoc.id;

        // Increase referral count
        await db.collection("users").doc(invitedByUid).update({
          referralCount: firebase.firestore.FieldValue.increment(1)
        });
      }
    }

    // 📝 2. Save user to Firestore (outside if-block)
    await db.collection("users").doc(user.uid).set({
      uid: user.uid,
      fullName: name,
      businessName: biz,
      email: email,
      displayName: email,
      joinedAt: firebase.firestore.FieldValue.serverTimestamp(),
      referralCode: generateReferralCode(),
      referralCount: 0,
      invitedByCode: inviteCode || null,
      invitedByUid: invitedByUid,

      tapCount: 0,
      tapLevel: 1,
      tapPower: 1,
      multiplier: 1,
      multiplierLevel: 1,
      minerLevel: 1,
      autoMinerLevel: 1,
      points: 0,
      totalCoins: 0,
      upgradeCount: 0,
      phoneNumber: "N/A",
      profileImage: "",
      language: "en",
      darkMode: false,
      monthlyBudget: 30000000,
      lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),

      settings: {
        darkMode: false,
        language: "en",
        reminders: false,
        securityLock: true,
        theme: "light"
      },

      tasks: {
        tapTask: {
          claimed: false,
          progress: 0,
          target: 100
        },
        referralTask: {
          claimed: false,
          progress: 0,
          target: 3
        },
        upgradeTask: {
          claimed: false,
          progress: 0,
          target: 5
        }
      }
    });

    // ✅ Email verification
    await user.sendEmailVerification();

    // ✅ Show success
    form.style.display = 'none';
    successState.style.display = 'block';

  } catch (error) {
    alert(`Registration error: ${error.message || 'Please try again'}`);
  } finally {
    signupBtn.disabled = false;
    signupBtn.innerHTML = oldHTML;
    loader.classList.add('hidden');
  }
};

  
  // Dashboard button
document.getElementById('dashboardBtn').addEventListener('click', () => {
  window.location.href = 'profile.html';   // ← real redirect
  // alert('Navigating to dashboard...');     // (remove or comment out)
});

  
  // Hide loader after initial load
  setTimeout(() => {
    loader.classList.add('hidden');
  }, 500);
});


 
</script>
</body>
</html>
