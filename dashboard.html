<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EasyKharcha - Expense Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --primary-light: #93c5fd;
      --secondary: #10b981;
      --accent: #f59e0b;
      --danger: #ef4444;
      --light: #f8fafc;
      --dark: #0f172a;
      --gray: #64748b;
      --card-bg: #ffffff;
      --card-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s ease;
      --warning: #ff9800;
      --border-radius: 16px;
      --header-gradient: linear-gradient(135deg, #2563eb, #1d4ed8);
    }

    .dark-mode {
      --primary: #3b82f6;
      --primary-light: #60a5fa;
      --secondary: #1e293b;
      --accent: #ef4444;
      --success: #10b981;
      --warning: #f59e0b;
      --text: #f1f5f9;
      --text-light: #94a3b8;
      --border: #334155;
      --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      --card-bg: #1e293b;
      background: #0f172a;
      color: var(--text);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      color: var(--dark);
      min-height: 100vh;
      padding: 16px;
      padding-bottom: 80px;
      transition: background 0.3s ease, color 0.3s ease;
      line-height: 1.6;
    }

    .dark-mode body {
      background: #0f172a;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Header Styles */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 24px;
      margin-bottom: 20px;
      background: var(--header-gradient);
      border-radius: var(--border-radius);
      box-shadow: var(--card-shadow);
      animation: slideDown 0.4s ease-out;
    }

    @keyframes slideDown {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 48px;
      height: 48px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .logo-icon:hover {
      transform: scale(1.05);
    }

    .logo-icon i {
      font-size: 24px;
      color: white;
    }

    .logo-text {
      font-size: 26px;
      font-weight: 700;
      color: white;
      letter-spacing: -0.5px;
    }

    .user-actions {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .theme-toggle, .user-profile {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .theme-toggle:hover, .user-profile:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateY(-2px);
    }

    .theme-toggle i {
      font-size: 20px;
      color: white;
    }

    .user-profile img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .language-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: white;
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 8px 12px;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.15);
      transition: all 0.3s ease;
    }

    .language-btn:hover {
      background: rgba(255, 255, 255, 0.25);
    }

    /* Summary Cards */
    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 24px;
      box-shadow: var(--card-shadow);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.1);
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
    }

    .card.balance::before { background: var(--primary); }
    .card.income::before { background: var(--secondary); }
    .card.expense::before { background: var(--danger); }
    .card.savings::before { background: var(--accent); }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .card-title {
      font-size: 16px;
      color: var(--gray);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .card-icon {
      width: 48px;
      height: 48px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
    }

    .card-icon.income {
      background: rgba(16, 185, 129, 0.15);
      color: var(--secondary);
    }

    .card-icon.expense {
      background: rgba(239, 68, 68, 0.15);
      color: var(--danger);
    }

    .card-icon.balance {
      background: rgba(37, 99, 235, 0.15);
      color: var(--primary);
    }

    .card-icon.savings {
      background: rgba(245, 158, 11, 0.15);
      color: var(--accent);
    }

    .card-icon i {
      font-size: 24px;
    }

    .card-value {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
      letter-spacing: -0.5px;
    }

    /* Budget Alert */
    .budget-alert {
      background-color: #fff8e1;
      border-left: 4px solid var(--warning);
      padding: 14px 18px;
      margin-bottom: 24px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }

    .dark-mode .budget-alert {
      background-color: #2b2100;
      border-left: 4px solid #ffc107;
    }

    /* Charts and Transactions */
    .dashboard-content {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }

    @media (max-width: 768px) {
      .dashboard-content {
        grid-template-columns: 1fr;
      }
    }

    .chart-container, .transactions-container {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 24px;
      box-shadow: var(--card-shadow);
      border: 1px solid rgba(0, 0, 0, 0.05);
      animation: fadeIn 0.6s ease-out;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 12px;
    }

    .section-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--dark);
      position: relative;
      padding-bottom: 8px;
    }

    .dark-mode .section-title {
      color: var(--text);
    }

    .section-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 40px;
      height: 3px;
      background: var(--primary);
      border-radius: 2px;
    }

    .view-all {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .view-all:hover {
      gap: 8px;
      color: var(--primary-dark);
    }

    .chart-wrapper {
      height: 300px;
      position: relative;
    }

    .transactions-list {
      max-height: 300px;
      overflow-y: auto;
      padding-right: 8px;
    }

    .transactions-list::-webkit-scrollbar {
      width: 6px;
    }

    .transactions-list::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.05);
      border-radius: 10px;
    }

    .transactions-list::-webkit-scrollbar-thumb {
      background: rgba(100, 116, 139, 0.3);
      border-radius: 10px;
    }

    .transactions-list::-webkit-scrollbar-thumb:hover {
      background: var(--primary-light);
    }

    .transaction-item {
      display: flex;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid rgba(100, 116, 139, 0.1);
      transition: background 0.3s ease;
      border-radius: 8px;
    }

    .transaction-item:hover {
      background: rgba(224, 242, 254, 0.3);
    }

    .dark-mode .transaction-item:hover {
      background: rgba(30, 41, 59, 0.5);
    }

    .transaction-icon {
      width: 42px;
      height: 42px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 16px;
      flex-shrink: 0;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
    }

    .transaction-icon.food {
      background: rgba(245, 158, 11, 0.15);
      color: var(--accent);
    }

    .transaction-icon.shopping {
      background: rgba(59, 130, 246, 0.15);
      color: #3b82f6;
    }

    .transaction-icon.transport {
      background: rgba(139, 92, 246, 0.15);
      color: #8b5cf6;
    }

    .transaction-icon.entertainment {
      background: rgba(236, 72, 153, 0.15);
      color: #ec4899;
    }

    .transaction-details {
      flex: 1;
      min-width: 0;
    }

    .transaction-title {
      font-weight: 600;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .transaction-category {
      font-size: 14px;
      color: var(--gray);
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .transaction-amount {
      font-weight: 700;
      font-size: 16px;
      flex-shrink: 0;
    }

    .expense-amount {
      color: var(--danger);
    }

    .income-amount {
      color: var(--secondary);
    }

    /* Action buttons */
    .transaction-actions {
      display: flex;
      gap: 10px;
      margin-left: 10px;
    }

    .action-btn {
      width: 30px;
      height: 30px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      background: rgba(0, 0, 0, 0.05);
    }

    .edit-btn {
      color: var(--primary);
    }

    .delete-btn {
      color: var(--danger);
    }

    .action-btn:hover {
      transform: scale(1.1);
      background: rgba(0, 0, 0, 0.1);
    }

    /* Expense Categories */
    .categories-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 24px;
      position: relative;
      padding-bottom: 8px;
    }

    .dark-mode .categories-title {
      color: var(--text);
    }

    .categories-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 40px;
      height: 3px;
      background: var(--primary);
      border-radius: 2px;
    }

    .categories-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .category-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      box-shadow: var(--card-shadow);
      transition: var(--transition);
      cursor: pointer;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .category-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 20px rgba(0, 0, 0, 0.08);
    }

    .category-icon {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 12px;
      font-size: 24px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
    }

    .category-name {
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 16px;
    }

    .category-amount {
      font-size: 14px;
      color: var(--gray);
      font-weight: 500;
    }

    /* Add Transaction Button */
    .add-transaction-btn {
      position: fixed;
      bottom: 90px;
      right: 20px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
      cursor: pointer;
      z-index: 100;
      transition: var(--transition);
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }

    .add-transaction-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 25px rgba(37, 99, 235, 0.5);
      animation: none;
    }

    /* Filter Container */
    .filter-container {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-container select {
      flex: 1;
      min-width: 150px;
      padding: 10px 14px;
      border-radius: 12px;
      border: 2px solid #e5e7eb;
      background: white;
      font-size: 14px;
      transition: border 0.3s ease;
    }

    .dark-mode .filter-container select {
      background: #1e293b;
      color: #f1f5f9;
      border-color: #334155;
    }

    .filter-container select:focus {
      border-color: var(--primary-light);
      outline: none;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
    }

    /* Export buttons */
    .export-buttons {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }

    .export-btn {
      flex: 1;
      padding: 12px 16px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .pdf-btn {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
    }

    .csv-btn {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
    }

    .export-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    /* Modal Styles */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      justify-content: center;
      align-items: center;
      z-index: 1000;
      animation: fadeIn 0.3s ease-in-out;
    }

    .modal-content {
      background: white;
      padding: 28px 32px;
      border-radius: 20px;
      min-width: 300px;
      max-width: 90%;
      width: 400px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      animation: slideUp 0.3s ease-in-out;
    }

    .dark-mode .modal-content {
      background: #1e293b;
      color: #f1f5f9;
    }

    .modal-content h3 {
      margin-bottom: 20px;
      font-size: 22px;
      text-align: center;
      font-weight: 600;
      position: relative;
      padding-bottom: 12px;
    }

    .dark-mode .modal-content h3 {
      color: #f1f5f9;
    }

    .modal-content h3::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 3px;
      background: var(--primary);
      border-radius: 2px;
    }

    .modal-content label {
      display: block;
      margin-top: 12px;
      font-weight: 500;
      font-size: 14px;
    }

    .dark-mode .modal-content label {
      color: #f1f5f9;
    }

    .modal-content input,
    .modal-content select {
      width: 100%;
      padding: 12px 16px;
      margin-top: 6px;
      border-radius: 12px;
      border: 2px solid #e5e7eb;
      margin-bottom: 10px;
      font-size: 16px;
      transition: border 0.3s ease;
    }

    .dark-mode .modal-content input,
    .dark-mode .modal-content select {
      background: #1e293b;
      color: #f1f5f9;
      border-color: #334155;
    }

    .modal-content input:focus,
    .modal-content select:focus {
      border-color: var(--primary-light);
      outline: none;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
    }

    .modal-actions {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 24px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 14px 20px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      flex: 1;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(37, 99, 235, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(37, 99, 235, 0.4);
    }

    .btn-cancel {
      background: #e5e7eb;
      padding: 14px 20px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 500;
      flex: 1;
      transition: all 0.3s ease;
    }

    .dark-mode .btn-cancel {
      background: #64748b;
      color: #f1f5f9;
    }

    .btn-cancel:hover {
      background: #d1d5db;
      transform: translateY(-2px);
    }

    @keyframes fadeIn {
      from { opacity: 0 }
      to { opacity: 1 }
    }

    @keyframes slideUp {
      from { transform: translateY(30px); opacity: 0 }
      to { transform: translateY(0); opacity: 1 }
    }

    /* Budget Meter */
    .budget-meter {
      height: 8px;
      background: #e5e7eb;
      border-radius: 4px;
      margin-top: 12px;
      overflow: hidden;
    }
    
    .budget-progress {
      height: 100%;
      background: var(--secondary);
      border-radius: 4px;
      transition: width 0.8s ease;
    }
    
    .budget-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 12px;
    }
    
    .edit-budget-btn {
      background: transparent;
      border: none;
      color: var(--primary);
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 5px;
      font-weight: 500;
      transition: all 0.3s ease;
      padding: 4px 8px;
      border-radius: 6px;
    }

    .edit-budget-btn:hover {
      background: rgba(37, 99, 235, 0.1);
    }
    
    .budget-status {
      font-size: 14px;
      margin-top: 5px;
      display: flex;
      justify-content: space-between;
    }
    
    .budget-remaining {
      color: var(--secondary);
      font-weight: 500;
    }
    
    .budget-exceeded {
      color: var(--danger);
    }

    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 70px;
      background: #fff;
      border-top: 1px solid #ddd;
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 1000;
      box-shadow: 0 -4px 10px rgba(0,0,0,0.08);
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
    }

    .dark-mode .bottom-nav {
      background: #1e293b;
      border-top: 1px solid #334155;
    }

    .nav-link {
      text-align: center;
      color: #555;
      font-size: 12px;
      flex: 1;
      padding: 8px 0;
      text-decoration: none;
      transition: color 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .dark-mode .nav-link {
      color: #94a3b8;
    }

    .nav-link i {
      font-size: 20px;
      transition: all 0.3s ease;
    }

    .nav-link.active {
      color: var(--primary);
    }

    .nav-link.active i {
      transform: translateY(-5px);
      color: var(--primary);
    }

    .nav-link:hover {
      color: var(--primary);
    }

    /* Budget History */
    .budget-history {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid rgba(0, 0, 0, 0.1);
    }

    .budget-history-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .budget-history-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      header {
        flex-direction: column;
        gap: 16px;
        text-align: center;
      }

      .logo {
        align-self: center;
      }

      .user-actions {
        align-self: center;
      }
      
      .summary-cards {
        grid-template-columns: 1fr 1fr;
      }
      
      .categories-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (max-width: 480px) {
      .card {
        padding: 16px;
      }

      .card-value {
        font-size: 24px;
      }

      .chart-container, .transactions-container {
        padding: 16px;
      }

      .transaction-item {
        padding: 12px 0;
      }
      
      .summary-cards {
        grid-template-columns: 1fr;
      }
      
      .categories-grid {
        grid-template-columns: 1fr 1fr;
      }

      .filter-container {
        flex-direction: column;
      }

      .filter-container select {
        width: 100%;
      }

      .export-buttons {
        flex-direction: column;
      }
    }

    /* Loading spinner */
    #loader {
      position: fixed;
      inset: 0;
      background: #ffffff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.3s ease;
    }

    .dark-mode #loader {
      background: #0f172a;
    }

    #loader.hidden {
      opacity: 0;
      pointer-events: none;
    }

    #loader .spinner {
      width: 48px;
      height: 48px;
      border: 5px solid #e0e0e0;
      border-top-color: #1a73e8;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .dark-mode #loader .spinner {
      border: 5px solid #334155;
      border-top-color: #3b82f6;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    #loader p {
      margin-top: 15px;
      color: #555;
      font-weight: 600;
    }

    .dark-mode #loader p {
      color: #94a3b8;
    }
    /* --- Page content --- */
body, html {
    margin: 0;
    padding: 0;
    font-family: 'Cairo', sans-serif;
}

main {
    padding-bottom: 80px; /* space for bottom nav (nav height + some buffer) */
}

/* --- Bottom Navigation --- */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 70px; /* nav height */
    background-color: var(--surface, #fff);
    display: flex;
    justify-content: space-around;
    align-items: center;
    box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.05);
    border-top: 1px solid var(--border, #ddd);
    z-index: 999;
    padding: 0 8px;
}

.bottom-nav-link {
    flex: 1;
    text-align: center;
    text-decoration: none;
    color: var(--text-secondary, #777);
    font-size: 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 60px;
    padding: 8px 0;
    border-radius: 12px;
    margin: 0 4px;
    transition: color 0.3s ease, background 0.3s ease;
}

.bottom-nav-link i {
    font-size: 20px;
    margin-bottom: 4px;
}

.bottom-nav-link span {
    font-size: 11px;
    line-height: 1;
    font-weight: 500;
}

.bottom-nav-link.active {
    color: var(--primary, #4361ee);
    background: rgba(67, 97, 238, 0.1);
}

/* Optional: make nav responsive */
@media (max-width: 600px) {
    .bottom-nav {
        height: 60px;
    }
    .bottom-nav-link i {
        font-size: 18px;
    }
    .bottom-nav-link span {
        font-size: 10px;
    }
}

  </style>
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <div id="loader">
    <div class="spinner"></div>
    <p>Loading Dashboard...</p>
  </div>

  <div class="container">
    <!-- Header -->
    <header>
      <div class="logo">
        <div class="logo-icon">
          <i class="fas fa-wallet"></i>
        </div>
        <div class="logo-text">EasyKharcha</div>
      </div>
      <div class="user-actions">
        <button class="theme-toggle" id="themeToggle">
          <i class="fas fa-moon"></i>
        </button>
        <button class="language-btn" id="languageBtn">
          <i class="fas fa-globe"></i> <span id="languageText">English</span>
        </button>
        <div class="user-profile">
          <img id="userAvatar" src="https://ui-avatars.com/api/?name=User&background=2563eb&color=fff" alt="User">
        </div>
      </div>
    </header>

    <!-- Budget Alert Placeholder -->
    <div id="budgetAlertContainer"></div>

    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="card balance">
        <div class="card-header">
          <div class="card-title">Total Balance</div>
          <div class="card-icon balance">
            <i class="fas fa-wallet"></i>
          </div>
        </div>
        <div class="card-value" id="totalBalance">RS0</div>
      </div>

      <div class="card income">
        <div class="card-header">
          <div class="card-title">Total Income</div>
          <div class="card-icon income">
            <i class="fas fa-arrow-down"></i>
          </div>
        </div>
        <div class="card-value" id="totalIncome">RS0</div>
      </div>

      <div class="card expense">
        <div class="card-header">
          <div class="card-title">Total Expense</div>
          <div class="card-icon expense">
            <i class="fas fa-arrow-up"></i>
          </div>
        </div>
        <div class="card-value" id="totalExpense">RS0</div>
      </div>

      <div class="card savings">
        <div class="card-header">
          <div class="card-title">Monthly Budget</div>
          <div class="card-icon savings">
            <i class="fas fa-piggy-bank"></i>
          </div>
        </div>
        <div class="card-value" id="totalBudget">RS0</div>
        <div class="budget-meter">
          <div class="budget-progress" id="budgetProgress"></div>
        </div>
        <div class="budget-status">
          <span id="budgetStatusText">RS0 remaining</span>
          <button class="edit-budget-btn" id="editBudgetBtn">
            <i class="fas fa-edit"></i> Edit
          </button>
        </div>
      </div>
    </div>

    <!-- Charts and Transactions -->
    <div class="dashboard-content">
      <div class="chart-container">
        <div class="section-header">
          <div class="section-title">Expense Analysis</div>
          <div class="export-buttons">
            <button class="export-btn pdf-btn" id="pdfExportBtn">
              <i class="fas fa-file-pdf"></i> PDF
            </button>
            <button class="export-btn csv-btn" id="csvExportBtn">
              <i class="fas fa-file-csv"></i> CSV
            </button>
          </div>
        </div>
        <div class="chart-wrapper">
          <canvas id="expenseChart"></canvas>
        </div>
      </div>

      <div class="transactions-container">
        <div class="section-header">
          <div class="section-title">Recent Transactions</div>
          <a href="#" class="view-all">
            View All <i class="fas fa-chevron-right"></i>
          </a>
        </div>
        
        <div class="filter-container">
          <!-- Category Filter -->
          <select id="categoryFilter">
            <option value="" selected>All Categories</option>
            <option value="Food">Food</option>
            <option value="Shopping">Shopping</option>
            <option value="Transport">Transport</option>
            <option value="Entertainment">Entertainment</option>
            <option value="Bills">Bills</option>
            <option value="Health">Health</option>
            <option value="Groceries">Groceries</option>
            <option value="Income">Income</option>
          </select>

          <!-- Month Filter -->
          <select id="monthFilter">
            <option value="" selected>All Months</option>
            <option value="0">January</option>
            <option value="1">February</option>
            <option value="2">March</option>
            <option value="3">April</option>
            <option value="4">May</option>
            <option value="5">June</option>
            <option value="6">July</option>
            <option value="7">August</option>
            <option value="8">September</option>
            <option value="9">October</option>
            <option value="10">November</option>
            <option value="11">December</option>
          </select>
        </div>
        <div class="transactions-list" id="transactionsList">
          <div class="no-transactions">Loading transactions...</div>
        </div>
      </div>
    </div>

    <!-- Expense Categories -->
    <div class="categories-title">Expense Categories</div>
    <div class="categories-grid" id="categoriesGrid">
      <div class="no-categories">Loading categories...</div>
    </div>

    <!-- Add Transaction Button -->
    <div class="add-transaction-btn" id="addTransactionBtn">
      <i class="fas fa-plus"></i>
    </div>
    
    <button class="btn-primary" id="logoutBtn" style="width: 100%; margin-top: 20px;">
      <i class="fas fa-sign-out-alt"></i> Logout
    </button>
  </div>

  <!-- Add Transaction Modal -->
  <div id="addModal" class="modal-overlay">
    <div class="modal-content">
      <h3>Add Transaction</h3>

      <label for="amountInput">Amount (RS)</label>
      <input id="amountInput" type="number" placeholder="Enter amount" required min="0.01" step="0.01">

      <label for="descriptionInput">Description</label>
      <input id="descriptionInput" type="text" placeholder="e.g. Dinner at Restaurant">

      <label for="categoryInput">Category</label>
      <select id="categoryInput" required>
        <option value="" disabled selected>Select category</option>
        <option value="Food">Food</option>
        <option value="Shopping">Shopping</option>
        <option value="Transport">Transport</option>
        <option value="Entertainment">Entertainment</option>
        <option value="Bills">Bills</option>
        <option value="Health">Health</option>
        <option value="Groceries">Groceries</option>
        <option value="Income">Income</option>
        <option value="Salary">Salary</option>
        <option value="Rent">Rent</option>
        <option value="Travel">Travel</option>
        <option value="Others">Others</option>
      </select>

      <label for="typeInput">Type</label>
      <select id="typeInput" required>
        <option value="expense" selected>Expense</option>
        <option value="income">Income</option>
      </select>

      <label for="dateInput">Date</label>
      <input id="dateInput" type="date" required>

      <div class="modal-actions">
        <button id="cancelBtn" class="btn-cancel">Cancel</button>
        <button id="saveBtn" class="btn-primary">Save</button>
      </div>
      <div id="formMessage"></div>
    </div>
  </div>
  
  <!-- Budget Modal -->
  <div id="budgetModal" class="modal-overlay">
    <div class="modal-content">
      <h3>Set Monthly Budget</h3>

      <label for="monthlyBudgetInput">Monthly Budget (RS)</label>
      <input type="number" id="monthlyBudgetInput" placeholder="Enter budget amount" min="0" step="100">

      <div class="modal-actions">
        <button id="closeBudgetModal" class="btn-cancel">Cancel</button>
        <button id="saveBudgetBtn" class="btn-primary">Save Budget</button>
      </div>
    </div>
  </div>

  
        <nav class="bottom-nav">
            <a href="profile.html" class="bottom-nav-link active">
                <i class="fas fa-user-circle"></i><span>Profile</span>
            </a>
            <a href="loan.html" class="bottom-nav-link">
                <i class="fas fa-money-bill-wave"></i><span>Loan</span>
            </a>
            <a href="dashboard.html" class="bottom-nav-link">
                <i class="fas fa-chart-line"></i><span>Dashboard</span>
            </a>
        </nav>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDHGd2EAJVUUYXa50G65GkutoiiHz9qtn8",
      authDomain: "easykharcha.firebaseapp.com",
      projectId: "easykharcha",
      storageBucket: "easykharcha.firebasestorage.app",
      messagingSenderId: "735642025618",
      appId: "1:735642025618:web:eacc16213b61c48c93f04b",
      measurementId: "G-JF3E4QMZQN"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    
    // Global variables
    let expenseChart = null;
    let currentUser = null;
    let transactions = [];
    let monthlyBudget = 0;
    let isDarkMode = false;
    let transactionsUnsubscribe = null;
    let budgetUnsubscribe = null;
    
    // Initialize the dashboard when page loads
    document.addEventListener('DOMContentLoaded', () => {
      // Event listeners
      document.getElementById('categoryFilter').addEventListener('change', renderTransactions);
      document.getElementById('monthFilter').addEventListener('change', renderTransactions);
      document.getElementById('addTransactionBtn').addEventListener('click', showAddModal);
      document.getElementById('logoutBtn').addEventListener('click', logoutUser);
      document.getElementById('saveBtn').addEventListener('click', saveTransaction);
      document.getElementById('cancelBtn').addEventListener('click', hideAddModal);
      document.getElementById('editBudgetBtn').addEventListener('click', showBudgetModal);
      document.getElementById('saveBudgetBtn').addEventListener('click', saveBudget);
      document.getElementById('closeBudgetModal').addEventListener('click', hideBudgetModal);
      document.getElementById('languageBtn').addEventListener('click', toggleLanguage);
      document.getElementById('themeToggle').addEventListener('click', toggleTheme);
      document.getElementById('pdfExportBtn').addEventListener('click', downloadPDF);
      document.getElementById('csvExportBtn').addEventListener('click', downloadCSV);
      
      // Initialize Firebase auth state listener
      auth.onAuthStateChanged(user => {
        if (user) {
          currentUser = user;
          document.getElementById('userAvatar').src = `https://ui-avatars.com/api/?name=${user.displayName || user.email}&background=2563eb&color=fff`;
          loadDashboardData();
        } else {
          // Redirect to login if not authenticated
          window.location.href = 'login.html';
        }
      });
    });

    // Toggle between English and Urdu
    function toggleLanguage() {
      const langText = document.getElementById('languageText');
      if (langText.textContent === 'English') {
        langText.textContent = 'Urdu';
      } else {
        langText.textContent = 'English';
      }
    }

    // Toggle dark/light theme
    function toggleTheme() {
      isDarkMode = !isDarkMode;
      document.body.classList.toggle('dark-mode', isDarkMode);
      
      // Update icon
      const themeIcon = document.querySelector('#themeToggle i');
      themeIcon.className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
    }

    // Load all dashboard data
    function loadDashboardData() {
      if (!currentUser) return;

      // Load budget
      loadBudget();

      // Load transactions with real-time updates
      loadTransactions();
    }

    // Load budget from Firestore
    function loadBudget() {
      if (!currentUser) return;

      const budgetRef = db.collection('users').doc(currentUser.uid).collection('settings').doc('monthlyBudget');
      
      budgetUnsubscribe = budgetRef.onSnapshot(doc => {
        if (doc.exists) {
          monthlyBudget = doc.data().amount || 0;
          document.getElementById('totalBudget').textContent = `RS${monthlyBudget}`;
          updateSummaryCards();
          checkBudgetStatus();
        } else {
          // Set default budget if not exists
          monthlyBudget = 30000;
          budgetRef.set({ amount: monthlyBudget });
        }
      }, error => {
        console.error("Error loading budget:", error);
        showNotification("Error loading budget", "error");
      });
    }

    // Load transactions with real-time updates
    function loadTransactions() {
      if (!currentUser) return;

      const transactionsRef = db.collection('users').doc(currentUser.uid).collection('transactions')
        .orderBy('createdAt', 'desc');
      
      transactionsUnsubscribe = transactionsRef.onSnapshot(snapshot => {
        transactions = [];
        snapshot.forEach(doc => {
          const data = doc.data();
          transactions.push({
            id: doc.id,
            amount: data.amount,
            description: data.description,
            category: data.category,
            type: data.type,
            date: data.date.toDate(),
            createdAt: data.createdAt.toDate()
          });
        });

        // Update UI
        updateSummaryCards();
        updateCategoriesGrid();
        initExpenseChart();
        renderTransactions();
        checkBudgetStatus();

        // Hide loader after data is loaded
        document.getElementById('loader').classList.add('hidden');
      }, error => {
        console.error("Error loading transactions:", error);
        showNotification("Error loading transactions", "error");
      });
    }

    // Render transactions based on filters
    function renderTransactions() {
      const transactionsList = document.getElementById('transactionsList');
      transactionsList.innerHTML = '';
      
      if (transactions.length === 0) {
        transactionsList.innerHTML = `<div class="no-transactions">No transactions found</div>`;
        return;
      }
      
      const selectedCategory = document.getElementById('categoryFilter').value;
      const selectedMonth = document.getElementById('monthFilter').value;
      
      const filteredTransactions = transactions.filter(transaction => {
        // Filter by category
        if (selectedCategory && transaction.category !== selectedCategory) {
          return false;
        }
        
        // Filter by month
        if (selectedMonth !== "") {
          const transactionDate = transaction.date;
          if (transactionDate.getMonth() != selectedMonth) {
            return false;
          }
        }
        
        return true;
      });
      
      if (filteredTransactions.length === 0) {
        transactionsList.innerHTML = `<div class="no-transactions">No transactions match the filters</div>`;
        return;
      }
      
      filteredTransactions.forEach(transaction => {
        const transactionDate = transaction.date;
        const formattedDate = `${transactionDate.getDate()} ${transactionDate.toLocaleString('default', { month: 'short' })}`;
        
        const typeClass = transaction.type === "income" ? "income-amount" : "expense-amount";
        const iconClass = getIconClass(transaction.category);
        const icon = getIcon(transaction.category);
        
        const transactionItem = document.createElement('div');
        transactionItem.className = 'transaction-item';
        transactionItem.innerHTML = `
          <div class="transaction-icon ${iconClass}">
            <i class="fas ${icon}"></i>
          </div>
          <div class="transaction-details">
            <div class="transaction-title">${transaction.description}</div>
            <div class="transaction-category">${transaction.category} â€¢ ${formattedDate}</div>
          </div>
          <div class="transaction-amount ${typeClass}">${transaction.type === 'income' ? '+' : '-'}RS${transaction.amount}</div>
          <div class="transaction-actions">
            <div class="action-btn edit-btn" data-id="${transaction.id}">
              <i class="fas fa-edit"></i>
            </div>
            <div class="action-btn delete-btn" data-id="${transaction.id}">
              <i class="fas fa-trash"></i>
            </div>
          </div>
        `;
        transactionsList.appendChild(transactionItem);
      });

      // Add event listeners to action buttons
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const transactionId = e.currentTarget.getAttribute('data-id');
          editTransaction(transactionId);
        });
      });

      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const transactionId = e.currentTarget.getAttribute('data-id');
          deleteTransaction(transactionId);
        });
      });
    }

    // Update summary cards with real data
    function updateSummaryCards() {
      let totalIncome = 0;
      let totalExpense = 0;
      const currentMonthExpense = getCurrentMonthExpense();
      
      transactions.forEach(transaction => {
        if (transaction.type === "income") {
          totalIncome += transaction.amount;
        } else if (transaction.type === "expense") {
          totalExpense += transaction.amount;
        }
      });
      
      const totalBalance = totalIncome - totalExpense;
      
      // Update budget progress
      const budgetProgress = document.getElementById('budgetProgress');
      const progressPercent = monthlyBudget > 0 ? Math.min((currentMonthExpense / monthlyBudget) * 100, 100) : 0;
      budgetProgress.style.width = `${progressPercent}%`;
      budgetProgress.style.background = progressPercent > 80 ? 
        (progressPercent > 95 ? 'var(--danger)' : 'var(--warning)') : 'var(--secondary)';
      
      // Update budget status
      const budgetStatusText = document.getElementById('budgetStatusText');
      const budgetRemaining = monthlyBudget - currentMonthExpense;
      
      if (budgetRemaining >= 0) {
        budgetStatusText.textContent = `RS${budgetRemaining} remaining`;
        budgetStatusText.className = "budget-remaining";
      } else {
        budgetStatusText.textContent = `RS${Math.abs(budgetRemaining)} over budget`;
        budgetStatusText.className = "budget-exceeded";
      }
      
      document.getElementById('totalBalance').textContent = `RS${totalBalance}`;
      document.getElementById('totalIncome').textContent = `RS${totalIncome}`;
      document.getElementById('totalExpense').textContent = `RS${totalExpense}`;
      document.getElementById('totalBudget').textContent = `RS${monthlyBudget}`;
    }
    
    // Get current month expense
    function getCurrentMonthExpense() {
      let currentMonthExpense = 0;
      const currentMonth = new Date().getMonth();
      const currentYear = new Date().getFullYear();
      
      transactions.forEach(transaction => {
        const transactionDate = transaction.date;
        if (transaction.type === "expense" && 
            transactionDate.getMonth() === currentMonth && 
            transactionDate.getFullYear() === currentYear) {
          currentMonthExpense += transaction.amount;
        }
      });
      
      return currentMonthExpense;
    }

    // Check if budget is exceeded and show alert
    function checkBudgetStatus() {
      const budgetAlertContainer = document.getElementById('budgetAlertContainer');
      budgetAlertContainer.innerHTML = '';
      
      if (monthlyBudget <= 0) return;
      
      const currentMonthExpense = getCurrentMonthExpense();
      const budgetRemaining = monthlyBudget - currentMonthExpense;
      
      // Show alert if budget is exceeded or almost exceeded
      if (budgetRemaining < 0) {
        const alert = document.createElement('div');
        alert.className = 'budget-alert';
        alert.innerHTML = `
          <i class="fas fa-exclamation-triangle"></i>
          <div>
            <strong>Budget Exceeded!</strong> 
            You are RS${Math.abs(budgetRemaining)} over budget this month.
          </div>
        `;
        budgetAlertContainer.appendChild(alert);
      } else if (budgetRemaining < (monthlyBudget * 0.2)) {
        const alert = document.createElement('div');
        alert.className = 'budget-alert';
        alert.innerHTML = `
          <i class="fas fa-exclamation-circle"></i>
          <div>
            <strong>Budget Alert!</strong> 
            Only RS${budgetRemaining} remaining in your monthly budget.
          </div>
        `;
        budgetAlertContainer.appendChild(alert);
      }
    }

    // Update categories grid with real data
    function updateCategoriesGrid() {
      const categoriesGrid = document.getElementById('categoriesGrid');
      categoriesGrid.innerHTML = '';
      
      const categories = {};
      const currentMonth = new Date().getMonth();
      const currentYear = new Date().getFullYear();
      
      // Aggregate expenses by category for current month
      transactions.forEach(transaction => {
        const transactionDate = transaction.date;
        if (transaction.type === "expense" && 
            transactionDate.getMonth() === currentMonth && 
            transactionDate.getFullYear() === currentYear) {
          const category = transaction.category;
          categories[category] = (categories[category] || 0) + transaction.amount;
        }
      });
      
      const categoryList = Object.entries(categories);
      if (categoryList.length === 0) {
        categoriesGrid.innerHTML = `<div class="no-categories">No expenses this month</div>`;
        return;
      }
      
      // Sort categories by amount (descending)
      categoryList.sort((a, b) => b[1] - a[1]);
      
      categoryList.forEach(([category, amount]) => {
        const icon = getIcon(category);
        const iconClass = getIconClass(category);
        const formattedAmount = `RS${amount}`;
        
        const categoryCard = document.createElement('div');
        categoryCard.className = 'category-card';
        categoryCard.innerHTML = `
          <div class="category-icon ${iconClass}">
            <i class="fas ${icon}"></i>
          </div>
          <div class="category-name">${category}</div>
          <div class="category-amount">${formattedAmount}</div>
        `;
        categoriesGrid.appendChild(categoryCard);
      });
    }

    // Initialize expense chart
    function initExpenseChart() {
      const ctx = document.getElementById('expenseChart');
      if (!ctx) return;
      
      // Prepare data for the chart
      const categories = {};
      const currentMonth = new Date().getMonth();
      const currentYear = new Date().getFullYear();
      
      // Aggregate expenses by category for current month
      transactions.forEach(transaction => {
        const transactionDate = transaction.date;
        if (transaction.type === "expense" && 
            transactionDate.getMonth() === currentMonth && 
            transactionDate.getFullYear() === currentYear) {
          const category = transaction.category;
          categories[category] = (categories[category] || 0) + transaction.amount;
        }
      });
      
      const categoryNames = Object.keys(categories);
      const categoryAmounts = Object.values(categories);
      
      // Destroy previous chart if exists
      if (expenseChart) {
        expenseChart.destroy();
      }
      
      // Create chart
      expenseChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: categoryNames,
          datasets: [{
            data: categoryAmounts,
            backgroundColor: [
              'rgba(245, 158, 11, 0.7)',
              'rgba(59, 130, 246, 0.7)',
              'rgba(139, 92, 246, 0.7)',
              'rgba(236, 72, 153, 0.7)',
              'rgba(16, 185, 129, 0.7)',
              'rgba(239, 68, 68, 0.7)',
              'rgba(251, 191, 36, 0.7)',
              'rgba(101, 163, 13, 0.7)',
              'rgba(234, 88, 12, 0.7)',
              'rgba(124, 58, 237, 0.7)'
            ],
            borderWidth: 1,
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const value = context.parsed || 0;
                  const total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                  const percentage = Math.round((value / total) * 100);
                  return `RS${value} (${percentage}%)`;
                }
              }
            }
          }
        }
      });
    }

    // Save new transaction
    async function saveTransaction() {
      const amount = parseFloat(document.getElementById("amountInput").value);
      const description = document.getElementById("descriptionInput").value.trim();
      const category = document.getElementById("categoryInput").value.trim();
      const type = document.getElementById("typeInput").value;
      const date = document.getElementById("dateInput").valueAsDate || new Date();
      
      // Validation
      if (!amount || amount <= 0) {
        showFormMessage("Please enter a valid amount", "error");
        return;
      }
      
      if (!category) {
        showFormMessage("Please select a category", "error");
        return;
      }
      
      try {
        // Save to Firestore
        await db.collection('users').doc(currentUser.uid).collection('transactions').add({
          amount: amount,
          description: description || category,
          category: category,
          type: type,
          date: firebase.firestore.Timestamp.fromDate(date),
          createdAt: firebase.firestore.Timestamp.fromDate(new Date())
        });
        
        // Show success message
        showFormMessage("Transaction added successfully!", "success");
        
        // Hide modal after success
        setTimeout(() => {
          hideAddModal();
        }, 1000);
      } catch (error) {
        console.error("Error adding transaction:", error);
        showFormMessage("Error adding transaction: " + error.message, "error");
      }
    }

    // Edit transaction
    async function editTransaction(transactionId) {
      const transaction = transactions.find(t => t.id === transactionId);
      if (!transaction) return;

      // Show modal with transaction data
      const modal = document.getElementById("addModal");
      modal.style.display = "flex";
      document.getElementById("formMessage").style.display = "none";
      document.getElementById("amountInput").value = transaction.amount;
      document.getElementById("descriptionInput").value = transaction.description;
      document.getElementById("categoryInput").value = transaction.category;
      document.getElementById("typeInput").value = transaction.type;
      document.getElementById("dateInput").valueAsDate = transaction.date;

      // Change modal title and button
      document.querySelector("#addModal h3").textContent = "Edit Transaction";
      document.getElementById("saveBtn").textContent = "Update";

      // Remove previous click handlers
      const saveBtn = document.getElementById("saveBtn");
      const newSaveBtn = saveBtn.cloneNode(true);
      saveBtn.parentNode.replaceChild(newSaveBtn, saveBtn);

      // Add new click handler for update
      newSaveBtn.addEventListener("click", async () => {
        const amount = parseFloat(document.getElementById("amountInput").value);
        const description = document.getElementById("descriptionInput").value.trim();
        const category = document.getElementById("categoryInput").value.trim();
        const type = document.getElementById("typeInput").value;
        const date = document.getElementById("dateInput").valueAsDate || new Date();

        // Validation
        if (!amount || amount <= 0) {
          showFormMessage("Please enter a valid amount", "error");
          return;
        }
        
        if (!category) {
          showFormMessage("Please select a category", "error");
          return;
        }

        try {
          // Update in Firestore
          await db.collection('users').doc(currentUser.uid).collection('transactions').doc(transactionId).update({
            amount: amount,
            description: description || category,
            category: category,
            type: type,
            date: firebase.firestore.Timestamp.fromDate(date)
          });

          // Show success message
          showFormMessage("Transaction updated successfully!", "success");
          
          // Hide modal after success
          setTimeout(() => {
            hideAddModal();
          }, 1000);
        } catch (error) {
          console.error("Error updating transaction:", error);
          showFormMessage("Error updating transaction: " + error.message, "error");
        }
      });
    }

    // Delete transaction
    async function deleteTransaction(transactionId) {
      if (!confirm("Are you sure you want to delete this transaction?")) return;

      try {
        await db.collection('users').doc(currentUser.uid).collection('transactions').doc(transactionId).delete();
        showNotification("Transaction deleted successfully", "success");
      } catch (error) {
        console.error("Error deleting transaction:", error);
        showNotification("Error deleting transaction", "error");
      }
    }

    // Save monthly budget
    async function saveBudget() {
      const budgetInput = document.getElementById("monthlyBudgetInput").value;
      const budgetValue = parseFloat(budgetInput);
      
      if (!budgetValue || budgetValue <= 0) {
        showNotification("Please enter a valid budget amount", "error");
        return;
      }
      
      try {
        // Save to Firestore
        await db.collection('users').doc(currentUser.uid).collection('settings').doc('monthlyBudget').set({
          amount: budgetValue
        }, { merge: true });
        
        // Hide modal
        hideBudgetModal();
        
        showNotification("Budget updated successfully!", "success");
      } catch (error) {
        console.error("Error saving budget:", error);
        showNotification("Error saving budget: " + error.message, "error");
      }
    }

    // Download PDF report
    function downloadPDF() {
      showNotification("Generating PDF report...", "info");
      
      setTimeout(() => {
        showNotification("PDF downloaded successfully", "success");
      }, 2000);
    }

    // Download CSV report
    function downloadCSV() {
      showNotification("Generating CSV file...", "info");
      
      setTimeout(() => {
        showNotification("CSV downloaded successfully", "success");
      }, 2000);
    }

    // Helper functions
    function getIcon(category) {
      const icons = {
        Food: 'fa-utensils',
        Shopping: 'fa-shopping-bag',
        Transport: 'fa-gas-pump',
        Entertainment: 'fa-film',
        Bills: 'fa-file-invoice',
        Income: 'fa-money-bill-wave',
        Salary: 'fa-briefcase',
        Rent: 'fa-home',
        Travel: 'fa-plane',
        Health: 'fa-heartbeat',
        Groceries: 'fa-apple-whole',
        Others: 'fa-receipt'
      };

      return icons[category] || 'fa-receipt';
    }

    function getIconClass(category) {
      const classes = {
        Food: 'food',
        Shopping: 'shopping',
        Transport: 'transport',
        Entertainment: 'entertainment',
        Bills: 'bills',
        Income: 'income',
        Salary: 'income',
        Rent: 'bills',
        Travel: 'transport',
        Health: 'health',
        Groceries: 'food',
      };

      return classes[category] || 'default-category';
    }

    function showFormMessage(message, type) {
      const formMessage = document.getElementById("formMessage");
      formMessage.textContent = message;
      formMessage.style.display = "block";
      formMessage.style.color = type === "error" ? "var(--danger)" : "var(--secondary)";
      formMessage.style.backgroundColor = type === "error" ? "var(--danger-light)" : "var(--success-light)";
      formMessage.style.padding = "10px";
      formMessage.style.borderRadius = "8px";
      formMessage.style.marginTop = "15px";
      formMessage.style.textAlign = "center";
    }
    
    function showNotification(message, type) {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      
      // Style based on type
      notification.style.position = 'fixed';
      notification.style.top = '20px';
      notification.style.left = '50%';
      notification.style.transform = 'translateX(-50%)';
      notification.style.padding = '12px 20px';
      notification.style.borderRadius = '8px';
      notification.style.backgroundColor = type === 'error' ? 'var(--danger)' : 'var(--secondary)';
      notification.style.color = 'white';
      notification.style.zIndex = '2000';
      notification.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
      notification.style.fontWeight = '500';
      
      // Add to body
      document.body.appendChild(notification);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }
    
    // Show add modal
    function showAddModal() {
      const modal = document.getElementById("addModal");
      modal.style.display = "flex";
      document.getElementById("formMessage").style.display = "none";
      document.getElementById("amountInput").value = '';
      document.getElementById("descriptionInput").value = '';
      document.getElementById("categoryInput").value = '';
      document.getElementById("typeInput").value = 'expense';
      document.getElementById("dateInput").valueAsDate = new Date();
      document.querySelector("#addModal h3").textContent = "Add Transaction";
      document.getElementById("saveBtn").textContent = "Save";
    }

    // Hide add modal
    function hideAddModal() {
      const modal = document.getElementById("addModal");
      modal.style.display = "none";
    }
    
    // Show budget modal
    function showBudgetModal() {
      const modal = document.getElementById("budgetModal");
      modal.style.display = "flex";
      document.getElementById("monthlyBudgetInput").value = monthlyBudget;
    }
    
    // Hide budget modal
    function hideBudgetModal() {
      const modal = document.getElementById("budgetModal");
      modal.style.display = "none";
    }

    // Logout user
    function logoutUser() {
      // Unsubscribe from listeners
      if (transactionsUnsubscribe) transactionsUnsubscribe();
      if (budgetUnsubscribe) budgetUnsubscribe();
      
      auth.signOut().then(() => {
        window.location.href = 'login.html';
      });
    }
  </script>
</body>
</html>
