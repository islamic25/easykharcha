<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

  <title>EasyKharcha - Expense Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Urdu RTL styles */
    body.urdu-mode {
      font-family: 'Noto Nastaliq Urdu', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      direction: rtl;
      text-align: right;
    }
    
    body.urdu-mode .logo-text,
    body.urdu-mode .card-title,
    body.urdu-mode .section-title,
    body.urdu-mode .transaction-title,
    body.urdu-mode .category-name,
    body.urdu-mode .budget-status,
    body.urdu-mode .budget-alert,
    body.urdu-mode .modal-content h3 {
      font-family: 'Noto Nastaliq Urdu', 'Segoe UI', Tahoma;
    }
    
    body.urdu-mode .view-all {
      flex-direction: row-reverse;
    }
    
    body.urdu-mode .view-all i {
      transform: rotate(180deg);
      margin-left: 0;
      margin-right: 4px;
    }
    
    body.urdu-mode .transaction-details {
      margin-right: 16px;
      margin-left: 0;
    }
    
    body.urdu-mode .transaction-amount {
      margin-left: 0;
      margin-right: auto;
    }
    
    body.urdu-mode .filter-container {
      flex-direction: row-reverse;
    }
    
    body.urdu-mode .modal-actions {
      flex-direction: row-reverse;
    }
    
    /* Dark mode styles */
    .dark-mode {
      --primary: #3b82f6;
      --primary-light: #60a5fa;
      --secondary: #1e293b;
      --accent: #ef4444;
      --success: #10b981;
      --warning: #f59e0b;
      --text: #f1f5f9;
      --text-light: #94a3b8;
      --border: #334155;
      --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      background: #0f172a;
      color: var(--text);
    }
    
    .dark-mode header {
      background: linear-gradient(135deg, #1e40af, #3b82f6);
    }
    
    .dark-mode .card, 
    .dark-mode .stat-card, 
    .dark-mode .filters {
      background: #1e293b;
      color: var(--text);
    }
    
    .dark-mode input, 
    .dark-mode select, 
    .dark-mode textarea {
      background: #1e293b;
      color: var(--text);
      border-color: var(--border);
    }
    
    .dark-mode .table-container {
      border-color: var(--border);
    }
    
    .dark-mode th {
      background: #1e293b;
    }
    
    .dark-mode td {
      border-bottom-color: var(--border);
      color: var(--text);
    }
    
    .dark-mode .bottom-nav {
      background: #1e293b;
      border-top-color: var(--border);
    }
    
    .dark-mode .bottom-nav-link {
      color: var(--text-light);
    }
    
    .dark-mode .bottom-nav-link.active {
      color: var(--primary-light);
    }
    
    .dark-mode .user-menu {
      background: #1e293b;
    }
    
    .dark-mode .user-menu-item {
      color: var(--text);
      border-bottom-color: var(--border);
    }
    
    .dark-mode .user-menu-item:hover {
      background: #334155;
    }
    
    /* Base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --primary-light: #93c5fd;
      --secondary: #10b981;
      --accent: #f59e0b;
      --danger: #ef4444;
      --light: #f8fafc;
      --dark: #0f172a;
      --gray: #64748b;
      --card-bg: #ffffff;
      --card-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s ease;
      --warning: #ff9800;
      --border-radius: 16px;
      --header-gradient: linear-gradient(135deg, #2563eb, #1d4ed8);
    }

    body {
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      color: var(--dark);
      min-height: 100vh;
      padding: 16px;
      padding-bottom: 70px;
      transition: background 0.3s ease, color 0.3s ease;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Header Styles */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
      margin-bottom: 20px;
      background: var(--header-gradient);
      border-radius: var(--border-radius);
      padding: 16px 24px;
      box-shadow: var(--card-shadow);
      animation: slideDown 0.4s ease-out;
    }

    @keyframes slideDown {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 48px;
      height: 48px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .logo-icon:hover {
      transform: scale(1.05);
    }

    .logo-icon i {
      font-size: 24px;
      color: white;
    }

    .logo-text {
      font-size: 26px;
      font-weight: 700;
      color: white;
      letter-spacing: -0.5px;
    }

    .logo-text span {
      color: rgba(255, 255, 255, 0.9);
    }

    .user-actions {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .notification-btn, .user-profile, .theme-toggle {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      position: relative;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .notification-btn:hover, .user-profile:hover, .theme-toggle:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateY(-2px);
    }

    .notification-btn i {
      font-size: 20px;
      color: white;
    }

    .notification-dot {
      position: absolute;
      top: 3px;
      right: 3px;
      width: 12px;
      height: 12px;
      background: var(--danger);
      border-radius: 50%;
      border: 2px solid rgba(29, 78, 216, 0.3);
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
      70% { box-shadow: 0 0 0 8px rgba(239, 68, 68, 0); }
      100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
    }

    .user-profile img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }
    
    /* Theme Toggle Button */
    .theme-toggle {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 20px;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Summary Cards */
    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 24px;
      box-shadow: var(--card-shadow);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.1);
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
    }

    .card.balance::before { background: var(--primary); }
    .card.income::before { background: var(--secondary); }
    .card.expense::before { background: var(--danger); }
    .card.savings::before { background: var(--accent); }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .card-title {
      font-size: 16px;
      color: var(--gray);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .card-icon {
      width: 48px;
      height: 48px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
    }

    .card-icon.income {
      background: rgba(16, 185, 129, 0.15);
      color: var(--secondary);
    }

    .card-icon.expense {
      background: rgba(239, 68, 68, 0.15);
      color: var(--danger);
    }

    .card-icon.balance {
      background: rgba(37, 99, 235, 0.15);
      color: var(--primary);
    }

    .card-icon.savings {
      background: rgba(245, 158, 11, 0.15);
      color: var(--accent);
    }

    .card-icon i {
      font-size: 24px;
    }

    .card-value {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
      letter-spacing: -0.5px;
    }

    .card-change {
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 4px;
      font-weight: 500;
    }

    .positive {
      color: var(--secondary);
    }

    .negative {
      color: var(--danger);
    }

    /* Budget Alert */
    .budget-alert {
      background-color: #fff8e1;
      border-left: 4px solid var(--warning);
      padding: 14px 18px;
      margin-bottom: 24px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      animation: pulse 2s infinite;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.01); }
      100% { transform: scale(1); }
    }

    .budget-alert i {
      color: var(--warning);
      font-size: 24px;
    }
    
    .dark-mode .budget-alert {
      background-color: #2b2100;
      border-left: 4px solid #ffc107;
    }

    /* Charts and Transactions */
    .dashboard-content {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }

    @media (max-width: 768px) {
      .dashboard-content {
        grid-template-columns: 1fr;
      }
    }

    .chart-container, .transactions-container {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 24px;
      box-shadow: var(--card-shadow);
      border: 1px solid rgba(0, 0, 0, 0.05);
      animation: fadeIn 0.6s ease-out;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 12px;
    }

    .section-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--dark);
      position: relative;
      padding-bottom: 8px;
    }

    .section-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 40px;
      height: 3px;
      background: var(--primary);
      border-radius: 2px;
    }

    .view-all {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .view-all:hover {
      gap: 8px;
      color: var(--primary-dark);
    }

    .chart-wrapper {
      height: 300px;
      position: relative;
    }

    .transactions-list {
      max-height: 300px;
      overflow-y: auto;
      padding-right: 8px;
    }

    .transactions-list::-webkit-scrollbar {
      width: 6px;
    }

    .transactions-list::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.05);
      border-radius: 10px;
    }

    .transactions-list::-webkit-scrollbar-thumb {
      background: rgba(100, 116, 139, 0.3);
      border-radius: 10px;
    }

    .transactions-list::-webkit-scrollbar-thumb:hover {
      background: var(--primary-light);
    }

    .transaction-item {
      display: flex;
      align-items: center;
      padding: 16px 0;
      border-bottom: 1px solid rgba(100, 116, 139, 0.1);
      transition: background 0.3s ease;
      border-radius: 8px;
      padding: 12px;
    }

    .transaction-item:hover {
      background: rgba(224, 242, 254, 0.3);
    }

    .dark-mode .transaction-item:hover {
      background: rgba(30, 41, 59, 0.5);
    }

    .transaction-icon {
      width: 48px;
      height: 48px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 16px;
      flex-shrink: 0;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
    }

    .transaction-icon.food {
      background: rgba(245, 158, 11, 0.15);
      color: var(--accent);
    }

    .transaction-icon.shopping {
      background: rgba(59, 130, 246, 0.15);
      color: #3b82f6;
    }

    .transaction-icon.transport {
      background: rgba(139, 92, 246, 0.15);
      color: #8b5cf6;
    }

    .transaction-icon.entertainment {
      background: rgba(236, 72, 153, 0.15);
      color: #ec4899;
    }

    .transaction-details {
      flex: 1;
      min-width: 0;
    }

    .transaction-title {
      font-weight: 600;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .transaction-category {
      font-size: 14px;
      color: var(--gray);
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .transaction-category::before {
      content: '•';
      opacity: 0.5;
    }

    .transaction-amount {
      font-weight: 700;
      font-size: 16px;
      flex-shrink: 0;
    }

    .expense-amount {
      color: var(--danger);
    }

    .income-amount {
      color: var(--secondary);
    }

    /* Categories */
    .categories-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 24px;
      position: relative;
      padding-bottom: 8px;
    }

    .categories-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 40px;
      height: 3px;
      background: var(--primary);
      border-radius: 2px;
    }

    .categories-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .category-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      box-shadow: var(--card-shadow);
      transition: var(--transition);
      cursor: pointer;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .category-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 20px rgba(0, 0, 0, 0.08);
    }

    .category-icon {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 12px;
      font-size: 24px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
    }

    .category-name {
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 16px;
    }

    .category-amount {
      font-size: 14px;
      color: var(--gray);
      font-weight: 500;
    }

    /* Add Transaction Button */
    .add-transaction-btn {
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
      cursor: pointer;
      z-index: 100;
      transition: var(--transition);
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }

    .add-transaction-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 25px rgba(37, 99, 235, 0.5);
      animation: none;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      header {
        flex-direction: column;
        gap: 16px;
        text-align: center;
      }

      .logo {
        align-self: center;
      }

      .user-actions {
        align-self: center;
      }
      
      .summary-cards {
        grid-template-columns: 1fr 1fr;
      }
      
      .categories-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (max-width: 480px) {
      .card {
        padding: 16px;
      }

      .card-value {
        font-size: 24px;
      }

      .chart-container, .transactions-container {
        padding: 16px;
      }

      .transaction-item {
        padding: 12px 0;
      }
      
      .summary-cards {
        grid-template-columns: 1fr;
      }
      
      .categories-grid {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      justify-content: center;
      align-items: center;
      z-index: 1000;
      animation: fadeIn 0.3s ease-in-out;
    }

    .modal-content {
      background: white;
      padding: 28px 32px;
      border-radius: 20px;
      min-width: 300px;
      max-width: 90%;
      width: 400px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      animation: slideUp 0.3s ease-in-out;
    }

    .modal-content h3 {
      margin-bottom: 20px;
      font-size: 22px;
      text-align: center;
      font-weight: 600;
      color: var(--dark);
      position: relative;
      padding-bottom: 12px;
    }

    .modal-content h3::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 3px;
      background: var(--primary);
      border-radius: 2px;
    }

    .modal-content label {
      display: block;
      margin-top: 12px;
      font-weight: 500;
      color: var(--dark);
      font-size: 14px;
    }

    .modal-content input,
    .modal-content select {
      width: 100%;
      padding: 12px 16px;
      margin-top: 6px;
      border-radius: 12px;
      border: 2px solid #e5e7eb;
      margin-bottom: 10px;
      font-size: 16px;
      transition: border 0.3s ease;
    }

    .modal-content input:focus,
    .modal-content select:focus {
      border-color: var(--primary-light);
      outline: none;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
    }

    .modal-actions {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 24px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 14px 20px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      flex: 1;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(37, 99, 235, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(37, 99, 235, 0.4);
    }

    .btn-cancel {
      background: #e5e7eb;
      padding: 14px 20px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 500;
      flex: 1;
      transition: all 0.3s ease;
    }

    .btn-cancel:hover {
      background: #d1d5db;
      transform: translateY(-2px);
    }

    @keyframes fadeIn {
      from { opacity: 0 }
      to { opacity: 1 }
    }

    @keyframes slideUp {
      from { transform: translateY(30px); opacity: 0 }
      to { transform: translateY(0); opacity: 1 }
    }
    
    .transaction-icon.bills {
      background: rgba(100, 116, 139, 0.15);
      color: #64748b;
    }

    .transaction-icon.income {
      background: rgba(16, 185, 129, 0.15);
      color: #10b981;
    }

    .transaction-icon.default-category {
      background: rgba(229, 231, 235, 0.15);
      color: #6b7280;
    }

    .transaction-icon.health {
      background: rgba(244, 63, 94, 0.15);
      color: #f43f5e;
    }

    .transaction-icon.groceries {
      background: rgba(251, 191, 36, 0.15);
      color: #fbbf24;
    }

    .filter-container {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-container select {
      flex: 1;
      min-width: 150px;
      padding: 10px 14px;
      border-radius: 12px;
      border: 2px solid #e5e7eb;
      background: white;
      font-size: 14px;
      transition: border 0.3s ease;
    }

    .filter-container select:focus {
      border-color: var(--primary-light);
      outline: none;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
    }

    #formMessage {
      margin-top: 15px;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      font-size: 14px;
      display: none;
    }

    .loading-spinner {
      display: none;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .no-transactions, .no-categories {
      text-align: center;
      padding: 20px;
      color: var(--gray);
      font-style: italic;
    }
    
    .logout-btn {
      background: transparent;
      border: none;
      color: var(--primary);
      cursor: pointer;
      font-weight: 500;
      margin-top: 10px;
      display: block;
      width: 100%;
      text-align: center;
      padding: 12px;
      transition: all 0.3s ease;
      border-radius: 8px;
      margin-top: 20px;
      font-weight: 600;
    }

    .logout-btn:hover {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
    }
    
    .budget-meter {
      height: 8px;
      background: #e5e7eb;
      border-radius: 4px;
      margin-top: 12px;
      overflow: hidden;
    }
    
    .budget-progress {
      height: 100%;
      background: var(--secondary);
      border-radius: 4px;
      transition: width 0.8s ease;
    }
    
    .budget-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 12px;
    }
    
    .edit-budget-btn {
      background: transparent;
      border: none;
      color: var(--primary);
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 5px;
      font-weight: 500;
      transition: all 0.3s ease;
      padding: 4px 8px;
      border-radius: 6px;
    }

    .edit-budget-btn:hover {
      background: rgba(37, 99, 235, 0.1);
    }
    
    .budget-modal-content {
      padding: 24px;
      border-radius: 20px;
      background: white;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    }
    
    .budget-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .budget-modal-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--dark);
      position: relative;
      padding-bottom: 12px;
      width: 100%;
    }

    .budget-modal-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 40px;
      height: 3px;
      background: var(--primary);
      border-radius: 2px;
    }
    
    .close-budget-modal {
      background: none;
      border: none;
      font-size: 28px;
      color: var(--gray);
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .close-budget-modal:hover {
      color: var(--dark);
    }
    
    .budget-input-container {
      margin-bottom: 24px;
    }
    
    .budget-input-container label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--dark);
      font-size: 14px;
    }
    
    .budget-input-container input {
      width: 100%;
      padding: 14px 16px;
      border-radius: 12px;
      border: 2px solid #e5e7eb;
      font-size: 16px;
      transition: border 0.3s ease;
    }

    .budget-input-container input:focus {
      border-color: var(--primary-light);
      outline: none;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
    }
    
    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 70px;
      background: #fff;
      border-top: 1px solid #ddd;
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 1000;
      box-shadow: 0 -4px 10px rgba(0,0,0,0.08);
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
    }

    .nav-link {
      text-align: center;
      color: #555;
      font-size: 12px;
      flex: 1;
      padding: 8px 0;
      text-decoration: none;
      transition: color 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .nav-link i {
      font-size: 20px;
      transition: all 0.3s ease;
    }

    .nav-link.active {
      color: var(--primary);
    }

    .nav-link.active i {
      transform: translateY(-5px);
      color: var(--primary);
    }

    .nav-link:hover {
      color: var(--primary);
    }
    
    /* Budget Status */
    .budget-status {
      font-size: 14px;
      margin-top: 5px;
      display: flex;
      justify-content: space-between;
    }
    
    .budget-remaining {
      color: var(--secondary);
      font-weight: 500;
    }
    
    .budget-exceeded {
      color: var(--danger);
      font-weight: 500;
    }
    
    .dark-mode .budget-modal-content {
      background: #1e293b;
      color: #f1f5f9;
    }
    
    .dark-mode .budget-input-container input {
      background: #1e293b;
      color: #f1f5f9;
      border-color: #334155;
    }
    
    .dark-mode .btn-cancel {
      background: #64748b;
      color: #f1f5f9;
    }
    
    .dark-mode .modal-content {
      background: #1e293b;
      color: #f1f5f9;
    }
    
    .dark-mode .modal-content input,
    .dark-mode .modal-content select {
      background: #1e293b;
      color: #f1f5f9;
      border-color: #334155;
    }
    
    .dark-mode .filter-container select {
      background: #1e293b;
      color: #f1f5f9;
      border-color: #334155;
    }
    
    /* Language switcher */
    .language-switcher {
      position: relative;
      margin-left: 10px;
    }
    
    .language-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: white;
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 8px 12px;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.15);
      transition: all 0.3s ease;
    }

    .language-btn:hover {
      background: rgba(255, 255, 255, 0.25);
    }
    
    .language-btn i {
      font-size: 16px;
    }

    /* Download PDF Button */
    .download-pdf-btn {
      background: linear-gradient(135deg, #004225 0%, #006633 100%);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 10px 20px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 66, 37, 0.2);
    }

    .download-pdf-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 66, 37, 0.3);
      gap: 12px;
    }
    
    @media print {
      .add-transaction-btn, .bottom-nav, .download-pdf-btn, .logout-btn {
        display: none !important;
        }
    }
    #loader {
  position: fixed;
  inset: 0;
  background: #ffffff;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  transition: opacity 0.3s ease;
}
#loader.hidden {
  opacity: 0;
  pointer-events: none;
}
#loader .spinner {
  width: 48px;
  height: 48px;
  border: 5px solid #e0e0e0;
  border-top-color: #1a73e8;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}
@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}
#loader p {
  margin-top: 15px;
  color: #555;
  font-weight: 600;
}
@media screen and (max-width: 500px) {
  .modal-content {
    width: 100%;
    height: 90vh;
    padding: 1rem;
    border-radius: 8px;
  }

  .modal-actions {
    flex-direction: column;
    gap: 10px;
  }

  .btn-primary, .btn-cancel {
    width: 100%;
  }
}
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 999;
  padding: 1rem;
}

.modal-content {
  background: white;
  border-radius: 10px;
  padding: 1.2rem;
  max-height: 90vh;
  width: 100%;
  max-width: 400px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.modal-actions {
  display: flex;
  justify-content: space-between;
  margin-top: 1rem;
  position: sticky;
  bottom: 0;
  background: white;
  padding-top: 0.5rem;
}
.danger-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: linear-gradient(to right, #ef4444, #dc2626);
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  cursor: pointer;
  transition: background 0.3s ease, transform 0.2s ease;
}

.danger-btn i {
  font-size: 18px;
}

.danger-btn:hover {
  background: linear-gradient(to right, #dc2626, #b91c1c);
  transform: scale(1.03);
  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.15);
}


  </style>

</head>
<body>
  <!-- Global Loader -->
<div id="loader">
  <div class="spinner"></div>
  <p>Loading…</p>
</div>

  <div class="container">
    <!-- Header -->
    <header>
      <div class="logo">
        <div class="logo-icon">
          <i class="fas fa-wallet"></i>
        </div>
        <div class="logo-text" id="appTitle">Easy<span>Kharcha</span></div>
      </div>
      <div class="user-actions">
        <button class="theme-toggle" id="themeToggle">
          <i class="fas fa-moon"></i>
        </button>
        <div class="language-switcher">
          <button class="language-btn" id="languageBtn">
            <i class="fas fa-globe"></i> <span id="languageText">English</span>
          </button>
        </div>
      
        <div class="user-profile">
          <img id="userAvatar" src="https://ui-avatars.com/api/?name=User&background=2563eb&color=fff" alt="User">
        </div>
      </div>
    </header>



    <!-- Budget Alert Placeholder -->
    <div id="budgetAlertContainer"></div>

    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="card balance">
        <div class="card-header">
          <div class="card-title" data-translate="total_balance">Total Balance</div>
          <div class="card-icon balance">
            <i class="fas fa-wallet"></i>
          </div>
        </div>
        <div class="card-value" id="totalBalance">RS0</div>
        <div class="card-change positive">
          <i class="fas fa-arrow-up"></i> RS0 (0%)
        </div>
      </div>

      <div class="card income">
        <div class="card-header">
          <div class="card-title" data-translate="total_income">Total Income</div>
          <div class="card-icon income">
            <i class="fas fa-arrow-down"></i>
          </div>
        </div>
        <div class="card-value" id="totalIncome">RS0</div>
        <div class="card-change positive">
          <i class="fas fa-arrow-up"></i> RS0 (0%)
        </div>
      </div>

      <div class="card expense">
        <div class="card-header">
          <div class="card-title" data-translate="total_expense">Total Expense</div>
          <div class="card-icon expense">
            <i class="fas fa-arrow-up"></i>
          </div>
        </div>
        <div class="card-value" id="totalExpense">RS0</div>
        <div class="card-change negative">
          <i class="fas fa-arrow-down"></i> RS0 (0%)
        </div>
      </div>

      <div class="card savings">
        <div class="card-header">
          <div class="card-title" data-translate="monthly_budget">Monthly Budget</div>
          <div class="card-icon savings">
            <i class="fas fa-piggy-bank"></i>
          </div>
        </div>
        <div class="card-value" id="totalBudget">RS0</div>
        <div class="budget-meter">
          <div class="budget-progress" id="budgetProgress"></div>
        </div>
        <div class="budget-status">
          <span id="budgetStatusText" data-translate="budget_remaining">RS0 remaining</span>
          <button class="edit-budget-btn" id="editBudgetBtn">
            <i class="fas fa-edit"></i> <span data-translate="edit">Edit</span>
          </button>
        </div>
      </div>
    </div>
<button onclick="deleteAllTransactions()" class="danger-btn">
  <i class="fas fa-trash"></i> Clear All Transactions
</button>

    <!-- Charts and Transactions -->
    <div class="dashboard-content">
      <div class="chart-container">
        <div class="section-header">
          <div class="section-title" data-translate="expense_analysis">Expense Analysis</div>
          <a href="#" class="view-all">
            <span data-translate="view_report">View Report</span> <i class="fas fa-chevron-right"></i>
          </a>
        </div>
        <div class="chart-wrapper">
          <canvas id="expenseChart"></canvas>
        </div>
      </div>

      <div class="transactions-container">
        <div class="section-header">
          <div class="section-title" data-translate="recent_transactions">Recent Transactions</div>
          <a href="#" class="view-all">
            <span data-translate="view_all">View All</span> <i class="fas fa-chevron-right"></i>
          </a>
        </div>
        
          <!-- Category Filter -->
          <select id="categoryFilter" required>
            <option value="" selected data-translate="all_categories">All Categories</option>
            <option value="Food" data-translate="food">Food</option>
            <option value="Shopping" data-translate="shopping">Shopping</option>
            <option value="Transport" data-translate="transport">Transport</option>
            <option value="Entertainment" data-translate="entertainment">Entertainment</option>
            <option value="Bills" data-translate="bills">Bills</option>
            <option value="Health" data-translate="health">Health</option>
            <option value="Groceries" data-translate="groceries">Groceries</option>
            <option value="Income" data-translate="income">Income</option>
          </select>

          <!-- Month Filter -->
          <select id="monthFilter" required>
            <option value="" selected data-translate="all_months">All Months</option>
            <option value="0" data-translate="january">January</option>
            <option value="1" data-translate="february">February</option>
            <option value="2" data-translate="march">March</option>
            <option value="3" data-translate="april">April</option>
            <option value="4" data-translate="may">May</option>
            <option value="5" data-translate="june">June</option>
            <option value="6" data-translate="july">July</option>
            <option value="7" data-translate="august">August</option>
            <option value="8" data-translate="september">September</option>
            <option value="9" data-translate="october">October</option>
            <option value="10" data-translate="november">November</option>
            <option value="11" data-translate="december">December</option>
          </select>
        </div>
        <div class="transactions-list" id="transactionsList">
          <div class="no-transactions" data-translate="loading_transactions">Loading transactions...</div>
        </div>
      </div>
    </div>

    <!-- Expense Categories -->
    <div class="categories-title" data-translate="expense_categories">Expense Categories</div>
    <div class="categories-grid" id="categoriesGrid">
      <div class="no-categories" data-translate="loading_categories">Loading categories...</div>
    </div>

    <!-- Add Transaction Button -->
    <div class="add-transaction-btn" id="addTransactionBtn">
      <i class="fas fa-plus"></i>
    </div>
    
    <button class="logout-btn" id="logoutBtn">
      <i class="fas fa-sign-out-alt"></i> <span data-translate="logout">Logout</span>
    </button>
  </div>

  <!-- Add Transaction Modal -->
  <div id="addModal" class="modal-overlay">
    <div class="modal-content">
      <h3 data-translate="add_transaction">Add Transaction</h3>

      <label for="amountInput" data-translate="amount">Amount (RS)</label>
      <input id="amountInput" type="number" placeholder="Enter amount" required min="0.01" step="0.01" />

      <label for="descriptionInput" data-translate="description">Description</label>
      <input id="descriptionInput" type="text" data-translate-placeholder="description_placeholder" placeholder="e.g. Dinner at Restaurant" />

      <label for="categoryInput" data-translate="category">Category</label>
      <select id="categoryInput" required>
        <option value="" disabled selected data-translate="select_category">Select category</option>
        <option value="Food" data-translate="food">Food</option>
        <option value="Shopping" data-translate="shopping">Shopping</option>
        <option value="Transport" data-translate="transport">Transport</option>
        <option value="Entertainment" data-translate="entertainment">Entertainment</option>
        <option value="Bills" data-translate="bills">Bills</option>
        <option value="Health" data-translate="health">Health</option>
        <option value="Groceries" data-translate="groceries">Groceries</option>
        <option value="Income" data-translate="income">Income</option>
        <option value="Salary" data-translate="salary">Salary</option>
        <option value="Rent" data-translate="rent">Rent</option>
        <option value="Travel" data-translate="travel">Travel</option>
        <option value="Others" data-translate="others">Others</option>
      </select>

      <label for="typeInput" data-translate="type">Type</label>
      <select id="typeInput" required>
        <option value="expense" data-translate="expense">Expense</option>
        <option value="income" data-translate="income">Income</option>
      </select>

      <label for="dateInput" data-translate="date">Date</label>
      <input id="dateInput" type="date" required />

      <div class="modal-actions">
        <button id="cancelBtn" class="btn-cancel" data-translate="cancel">Cancel</button>
        <button id="saveBtn" class="btn-primary" data-translate="save">Save</button>
      </div>
      <div id="formMessage"></div>
    </div>
  </div>
  
  <!-- Budget Modal -->
  <div id="budgetModal" class="modal-overlay">
    <div class="budget-modal-content">
      <div class="budget-modal-header">
        <h3 class="budget-modal-title" data-translate="set_monthly_budget">Set Monthly Budget</h3>
        <button class="close-budget-modal" id="closeBudgetModal">&times;</button>
      </div>
      <div class="budget-input-container">
        <label for="monthlyBudgetInput" data-translate="monthly_budget">Monthly Budget (RS)</label>
        <input type="number" id="monthlyBudgetInput" data-translate-placeholder="budget_placeholder" placeholder="Enter budget amount" min="0" step="100">
      </div>
      <button id="saveBudgetBtn" class="btn-primary" data-translate="save_budget">Save Budget</button>
    </div>
  </div>
<!-- Hidden PDF Content -->
<div id="pdfContent" style="display: none; padding: 20px; font-family: sans-serif;">
  <h2 style="text-align: center;">EasyKharcha - Summary Report</h2>
  <div style="margin-bottom: 20px;">
    <p><strong>Total Income:</strong> <span id="pdfTotalIncome">--</span></p>
    <p><strong>Total Expense:</strong> <span id="pdfTotalExpense">--</span></p>
    <p><strong>Total Balance:</strong> <span id="pdfTotalBalance">--</span></p>
  </div>

  <h3>Recent Transactions</h3>
  <table style="width: 100%; border-collapse: collapse;" border="1" cellspacing="0" cellpadding="6">
    <thead style="background: #f1f1f1;">
      <tr>
        <th>Date</th>
        <th>Description</th>
        <th>Category</th>
        <th>Type</th>
        <th>Amount (RS)</th>
      </tr>
    </thead>
    <tbody id="pdfTransactionTable"></tbody>
  </table>
</div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDHGd2EAJVUUYXa50G65GkutoiiHz9qtn8",
      authDomain: "easykharcha.firebaseapp.com",
      projectId: "easykharcha",
      storageBucket: "easykharcha.firebasestorage.app",
      messagingSenderId: "735642025618",
      appId: "1:735642025618:web:eacc16213b61c48c93f04b",
      measurementId: "G-JF3E4QMZQN"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    
    // Global variables
    let expenseChart = null;
    let currentUser = null;
    let transactions = [];
    let monthlyBudget = 30000; // Default monthly budget
    let currentLanguage = 'en'; // Default language
    let isDarkMode = false; // Default theme
    
    // Language translations
    const translations = {
      en: {
        app_title: "EasyKharcha",
        total_balance: "Total Balance",
        total_income: "Total Income",
        total_expense: "Total Expense",
        monthly_budget: "Monthly Budget",
        edit: "Edit",
        budget_remaining: "RS0 remaining",
        budget_exceeded: "RS0 over budget",
        expense_analysis: "Expense Analysis",
        view_report: "View Report",
        recent_transactions: "Recent Transactions",
        view_all: "View All",
        expense_categories: "Expense Categories",
        logout: "Logout",
        add_transaction: "Add Transaction",
        amount: "Amount (RS)",
        description: "Description",
        description_placeholder: "e.g. Dinner at Restaurant",
        category: "Category",
        select_category: "Select category",
        food: "Food",
        shopping: "Shopping",
        transport: "Transport",
        entertainment: "Entertainment",
        bills: "Bills",
        health: "Health",
        groceries: "Groceries",
        income: "Income",
        salary: "Salary",
        rent: "Rent",
        travel: "Travel",
        others: "Others",
        type: "Type",
        expense: "Expense",
        date: "Date",
        cancel: "Cancel",
        save: "Save",
        set_monthly_budget: "Set Monthly Budget",
        monthly_budget: "Monthly Budget (RS)",
        budget_placeholder: "Enter budget amount",
        save_budget: "Save Budget",
        all_categories: "All Categories",
        all_months: "All Months",
        january: "January",
        february: "February",
        march: "March",
        april: "April",
        may: "May",
        june: "June",
        july: "July",
        august: "August",
        september: "September",
        october: "October",
        november: "November",
        december: "December",
        loading_transactions: "Loading transactions...",
        loading_categories: "Loading categories...",
        no_transactions: "No transactions found",
        no_match: "No transactions match the filters",
        no_expenses: "No expenses this month",
        language: "English",
        dashboard: "Dashboard",
        loans: "Loans",
        profile: "Profile",
        download_pdf: "Download PDF"
      },
      ur: {
        app_title: "آسان خرچہ",
        total_balance: "کل بیلنس",
        total_income: "کل آمدنی",
        total_expense: "کل خرچ",
        monthly_budget: "ماہانہ بجٹ",
        edit: "ترمیم",
        budget_remaining: "RS0 باقی",
        budget_exceeded: "RS0 بجٹ سے زیادہ",
        expense_analysis: "خرچ کا تجزیہ",
        view_report: "رپورٹ دیکھیں",
        recent_transactions: "حالیہ لین دین",
        view_all: "سب دیکھیں",
        expense_categories: "خرچ کی اقسام",
        logout: "لاگ آؤٹ",
        add_transaction: "لین دین شامل کریں",
        amount: "رقم (RS)",
        description: "تفصیل",
        description_placeholder: "مثال: ریستوران میں رات کا کھانا",
        category: "قسم",
        select_category: "قسم منتخب کریں",
        food: "کھانا",
        shopping: "خریداری",
        transport: "ٹرانسپورٹ",
        entertainment: "تفریح",
        bills: "بل",
        health: "صحت",
        groceries: "گروسری",
        income: "آمدنی",
        salary: "تنخواہ",
        rent: "کرایہ",
        travel: "سفر",
        others: "دیگر",
        type: "قسم",
        expense: "خرچ",
        date: "تاریخ",
        cancel: "منسوخ",
        save: "محفوظ کریں",
        set_monthly_budget: "ماہانہ بجٹ طے کریں",
        monthly_budget: "ماہانہ بجٹ (RS)",
        budget_placeholder: "رقم درج کریں",
        save_budget: "بجٹ محفوظ کریں",
        all_categories: "تمام اقسام",
        all_months: "تمام مہینے",
        january: "جنوری",
        february: "فروری",
        march: "مارچ",
        april: "اپریل",
        may: "مئی",
        june: "جون",
        july: "جولائی",
        august: "اگست",
        september: "ستمبر",
        october: "اکتوبر",
        november: "نومبر",
        december: "دسمبر",
        loading_transactions: "لین دین لوڈ ہو رہے ہیں...",
        loading_categories: "اقسام لوڈ ہو رہی ہیں...",
        no_transactions: "کوئی لین دین نہیں ملا",
        no_match: "کوئی لین دین فلٹرز سے میل نہیں کھاتا",
        no_expenses: "اس مہینے کوئی خرچ نہیں",
        language: "اردو",
        dashboard: "ڈیش بورڈ",
        loans: "قرضے",
        profile: "پروفائل",
        download_pdf: "پی ڈی ایف ڈاؤن لوڈ کریں"
      }
    };

    // Initialize the dashboard when page loads
    document.addEventListener('DOMContentLoaded', () => {
      // Event listeners
      document.getElementById('categoryFilter').addEventListener('change', renderTransactions);
      document.getElementById('monthFilter').addEventListener('change', renderTransactions);
      document.getElementById('addTransactionBtn').addEventListener('click', showAddModal);
      document.getElementById('logoutBtn').addEventListener('click', logoutUser);
      document.getElementById('saveBtn').addEventListener('click', saveTransaction);
      document.getElementById('cancelBtn').addEventListener('click', hideAddModal);
      document.getElementById('editBudgetBtn').addEventListener('click', showBudgetModal);
      document.getElementById('saveBudgetBtn').addEventListener('click', saveBudget);
      document.getElementById('closeBudgetModal').addEventListener('click', hideBudgetModal);
      document.getElementById('languageBtn').addEventListener('click', toggleLanguage);
      document.getElementById('themeToggle').addEventListener('click', toggleTheme);
      
      // Initialize Firebase auth state listener
      auth.onAuthStateChanged(user => {
        if (user) {
          currentUser = user;
          document.getElementById('userAvatar').src = `https://ui-avatars.com/api/?name=${user.displayName || user.email}&background=2563eb&color=fff`;
          loadDashboardData();
        } else {
          // Redirect to login if not authenticated
          window.location.href = 'login.html';
        }
      });
    });

    // Toggle between English and Urdu
    function toggleLanguage() {
      const newLanguage = currentLanguage === 'en' ? 'ur' : 'en';
      setLanguage(newLanguage);
      saveUserSettings();
    }

    // Toggle dark/light theme
    function toggleTheme() {
      isDarkMode = !isDarkMode;
      applyTheme(isDarkMode);
      saveUserSettings();
      
      // Update icon
      const themeIcon = document.querySelector('#themeToggle i');
      themeIcon.className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
    }

    // Apply theme to the page
    function applyTheme(isDark) {
      if (isDark) {
        document.body.classList.add('dark-mode');
      } else {
        document.body.classList.remove('dark-mode');
      }
    }

    // Set application language
    function setLanguage(lang) {
      currentLanguage = lang;
      
      // Update UI elements with translations
      const elements = document.querySelectorAll('[data-translate]');
      elements.forEach(el => {
        const key = el.getAttribute('data-translate');
        if (translations[lang][key]) {
          el.textContent = translations[lang][key];
        }
      });
      
      // Update placeholders
      const placeholders = document.querySelectorAll('[data-translate-placeholder]');
      placeholders.forEach(el => {
        const key = el.getAttribute('data-translate-placeholder');
        if (translations[lang][key]) {
          el.placeholder = translations[lang][key];
        }
      });
      
      // Update select options
      const options = document.querySelectorAll('option[data-translate]');
      options.forEach(option => {
        const key = option.getAttribute('data-translate');
        if (translations[lang][key]) {
          option.textContent = translations[lang][key];
        }
      });
      
      // Update language button text
      document.getElementById('languageText').textContent = translations[lang].language;
      
      // Apply RTL for Urdu
      if (lang === 'ur') {
        document.body.classList.add('urdu-mode');
      } else {
        document.body.classList.remove('urdu-mode');
      }
      
      // Update budget status text
      updateBudgetStatusText();
    }
    
    // Save user settings (theme and language) to Firestore
    async function saveUserSettings() {
      try {
        await db.collection("users").doc(currentUser.uid).set({
          settings: {
            language: currentLanguage,
            darkMode: isDarkMode
          }
        }, { merge: true });
      } catch (error) {
        console.error("Error saving user settings:", error);
      }
    }
    
    // Load user settings from Firestore
    async function loadUserSettings() {
      try {
        const doc = await db.collection("users").doc(currentUser.uid).get();
        if (doc.exists) {
          const data = doc.data();
          const settings = data.settings || {};
          
          // Apply language
          if (settings.language) {
            setLanguage(settings.language);
          }
          
          // Apply theme
          if (settings.darkMode !== undefined) {
            isDarkMode = settings.darkMode;
            applyTheme(isDarkMode);
            
            // Update theme icon
            const themeIcon = document.querySelector('#themeToggle i');
            themeIcon.className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
          }
        }
      } catch (error) {
        console.error("Error loading user settings:", error);
      }
    }
    
    // Update budget status text based on language
    function updateBudgetStatusText() {
      const budgetStatusText = document.getElementById('budgetStatusText');
      const budgetRemaining = monthlyBudget - getCurrentMonthExpense();
      
      if (budgetRemaining >= 0) {
        budgetStatusText.textContent = `RS${budgetRemaining.toLocaleString()} ${translations[currentLanguage].budget_remaining.split('RS0')[1]}`;
        budgetStatusText.className = "budget-remaining";
      } else {
        budgetStatusText.textContent = `RS${Math.abs(budgetRemaining).toLocaleString()} ${translations[currentLanguage].budget_exceeded.split('RS0')[1]}`;
        budgetStatusText.className = "budget-exceeded";
      }
    }
    
    // Get current month expense
    function getCurrentMonthExpense() {
      let currentMonthExpense = 0;
      const currentMonth = new Date().getMonth();
      
      transactions.forEach(transaction => {
        if (transaction.type === "expense" && transaction.date.getMonth() === currentMonth) {
          currentMonthExpense += transaction.amount;
        }
      });
      
      return currentMonthExpense;
    }

    // Load all dashboard data
    async function loadDashboardData() {
      try {
        // Load user settings (language and theme)
        await loadUserSettings();
        
        // Load user preferences
        await loadUserPreferences();
        
        // Load transactions
        await loadTransactions();
        
        // Update summary cards
        updateSummaryCards();
        
        // Update categories grid
        updateCategoriesGrid();
        
        // Initialize the chart
        initExpenseChart();
        
        // Check budget status
        checkBudgetStatus();
      } catch (error) {
        console.error("Error loading dashboard data:", error);
        showNotification("Error loading dashboard data. Please try again.", "error");
      }
    }

    // Load user preferences
    async function loadUserPreferences() {
      try {
        const doc = await db.collection("users").doc(currentUser.uid).get();
        if (doc.exists) {
          const data = doc.data();
          monthlyBudget = data.monthlyBudget || 30000;
          document.getElementById('totalBudget').textContent = `RS${monthlyBudget.toLocaleString()}`;
        }
      } catch (error) {
        console.error("Error loading user preferences:", error);
      }
    }

    // Load transactions from Firestore
    async function loadTransactions() {
      try {
        const snapshot = await db.collection("users").doc(currentUser.uid).collection("transactions")
          .orderBy("date", "desc")
          .limit(50)
          .get();
        
        transactions = [];
        snapshot.forEach(doc => {
          const data = doc.data();
          transactions.push({
            id: doc.id,
            ...data,
            date: data.date?.toDate?.() || new Date(data.date)
          });
        });
        
        renderTransactions();
      } catch (error) {
        console.error("Error loading transactions:", error);
        showNotification("Error loading transactions. Please try again.", "error");
      }
    }

    // Render transactions based on filters
    function renderTransactions() {
      const transactionsList = document.getElementById('transactionsList');
      transactionsList.innerHTML = '';
      
      if (transactions.length === 0) {
        transactionsList.innerHTML = `<div class="no-transactions">${translations[currentLanguage].no_transactions}</div>`;
        return;
      }
      
      const selectedCategory = document.getElementById('categoryFilter').value;
      const selectedMonth = document.getElementById('monthFilter').value;
      
      const filteredTransactions = transactions.filter(transaction => {
        // Filter by category
        if (selectedCategory && transaction.category !== selectedCategory) {
          return false;
        }
        
        // Filter by month
        if (selectedMonth !== "") {
          const transactionDate = transaction.date;
          if (transactionDate.getMonth() != selectedMonth) {
            return false;
          }
        }
        
        return true;
      });
      
      if (filteredTransactions.length === 0) {
        transactionsList.innerHTML = `<div class="no-transactions">${translations[currentLanguage].no_match}</div>`;
        return;
      }
      
      filteredTransactions.forEach(transaction => {
        const transactionDate = transaction.date;
        const formattedDate = `${transactionDate.getDate()} ${transactionDate.toLocaleString('default', { month: 'short' })}`;
        
        const typeClass = transaction.type === "income" ? "income-amount" : "expense-amount";
        const iconClass = getIconClass(transaction.category);
        const icon = getIcon(transaction.category);
        
        const transactionItem = document.createElement('div');
        transactionItem.className = 'transaction-item';
        transactionItem.innerHTML = `
          <div class="transaction-icon ${iconClass}">
            <i class="fas ${icon}"></i>
          </div>
          <div class="transaction-details">
            <div class="transaction-title">${transaction.description || transaction.category}</div>
            <div class="transaction-category">${transaction.category} • ${formattedDate}</div>
          </div>
          <div class="transaction-amount ${typeClass}">${transaction.type === 'income' ? '+' : '-'}RS${transaction.amount.toLocaleString()}</div>
        `;
        transactionsList.appendChild(transactionItem);
      });
    }

    // Update summary cards with real data
    function updateSummaryCards() {
      let totalIncome = 0;
      let totalExpense = 0;
      const currentMonthExpense = getCurrentMonthExpense();
      
      transactions.forEach(transaction => {
        if (transaction.type === "income") {
          totalIncome += transaction.amount;
        } else if (transaction.type === "expense") {
          totalExpense += transaction.amount;
        }
      });
      
      const totalBalance = totalIncome - totalExpense;
      
      // Update budget progress
      const budgetProgress = document.getElementById('budgetProgress');
      const progressPercent = Math.min((currentMonthExpense / monthlyBudget) * 100, 100);
      budgetProgress.style.width = `${progressPercent}%`;
      budgetProgress.style.background = progressPercent > 80 ? 
        (progressPercent > 95 ? 'var(--danger)' : 'var(--warning)') : 'var(--secondary)';
      
      // Update budget status
      updateBudgetStatusText();
      
      document.getElementById('totalBalance').textContent = `RS${totalBalance.toLocaleString()}`;
      document.getElementById('totalIncome').textContent = `RS${totalIncome.toLocaleString()}`;
      document.getElementById('totalExpense').textContent = `RS${totalExpense.toLocaleString()}`;
    }
    
    // Check if budget is exceeded and show alert
    function checkBudgetStatus() {
      const budgetAlertContainer = document.getElementById('budgetAlertContainer');
      budgetAlertContainer.innerHTML = '';
      
      const currentMonthExpense = getCurrentMonthExpense();
      const budgetRemaining = monthlyBudget - currentMonthExpense;
      
      // Show alert if budget is exceeded or almost exceeded
      if (budgetRemaining < 0) {
        const alert = document.createElement('div');
        alert.className = 'budget-alert';
        alert.innerHTML = `
          <i class="fas fa-exclamation-triangle"></i>
          <div>
            <strong>${translations[currentLanguage].budget_exceeded.split('RS0')[0]}</strong> 
            ${translations[currentLanguage].budget_exceeded.replace('RS0', `RS${Math.abs(budgetRemaining).toLocaleString()}`)}
          </div>
        `;
        budgetAlertContainer.appendChild(alert);
      } else if (budgetRemaining < (monthlyBudget * 0.2)) {
        const alert = document.createElement('div');
        alert.className = 'budget-alert';
        alert.innerHTML = `
          <i class="fas fa-exclamation-circle"></i>
          <div>
            <strong>${translations[currentLanguage].budget_remaining.split('RS0')[0]}</strong> 
            ${translations[currentLanguage].budget_remaining.replace('RS0', `RS${budgetRemaining.toLocaleString()}`)}
          </div>
        `;
        budgetAlertContainer.appendChild(alert);
      }
    }

    // Update categories grid with real data
    function updateCategoriesGrid() {
      const categoriesGrid = document.getElementById('categoriesGrid');
      categoriesGrid.innerHTML = '';
      
      const categories = {};
      const currentMonth = new Date().getMonth();
      
      // Aggregate expenses by category for current month
      transactions.forEach(transaction => {
        if (transaction.type === "expense" && transaction.date.getMonth() === currentMonth) {
          const category = transaction.category;
          categories[category] = (categories[category] || 0) + transaction.amount;
        }
      });
      
      const categoryList = Object.entries(categories);
      if (categoryList.length === 0) {
        categoriesGrid.innerHTML = `<div class="no-categories">${translations[currentLanguage].no_expenses}</div>`;
        return;
      }
      
      // Sort categories by amount (descending)
      categoryList.sort((a, b) => b[1] - a[1]);
      
      categoryList.forEach(([category, amount]) => {
        const icon = getIcon(category);
        const iconClass = getIconClass(category);
        const formattedAmount = `RS${amount.toLocaleString()}`;
        
        const categoryCard = document.createElement('div');
        categoryCard.className = 'category-card';
        categoryCard.innerHTML = `
          <div class="category-icon ${iconClass}">
            <i class="fas ${icon}"></i>
          </div>
          <div class="category-name">${category}</div>
          <div class="category-amount">${formattedAmount}</div>
        `;
        categoriesGrid.appendChild(categoryCard);
      });
    }

    // Initialize expense chart
    function initExpenseChart() {
      const ctx = document.getElementById('expenseChart');
      if (!ctx) return;
      
      // Destroy previous chart if exists
      if (expenseChart) {
        expenseChart.destroy();
      }
      
      // Prepare data for the chart
      const categories = {};
      const currentMonth = new Date().getMonth();
      
      // Aggregate expenses by category for current month
      transactions.forEach(transaction => {
        if (transaction.type === "expense" && transaction.date.getMonth() === currentMonth) {
          const category = transaction.category;
          categories[category] = (categories[category] || 0) + transaction.amount;
        }
      });
      
      const categoryNames = Object.keys(categories);
      const categoryAmounts = Object.values(categories);
      
      // Create chart
      expenseChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: categoryNames,
          datasets: [{
            data: categoryAmounts,
            backgroundColor: [
              'rgba(245, 158, 11, 0.7)',
              'rgba(59, 130, 246, 0.7)',
              'rgba(139, 92, 246, 0.7)',
              'rgba(236, 72, 153, 0.7)',
              'rgba(16, 185, 129, 0.7)',
              'rgba(239, 68, 68, 0.7)',
              'rgba(251, 191, 36, 0.7)',
              'rgba(101, 163, 13, 0.7)',
              'rgba(234, 88, 12, 0.7)',
              'rgba(124, 58, 237, 0.7)'
            ],
            borderWidth: 1,
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const value = context.parsed || 0;
                  const total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                  const percentage = Math.round((value / total) * 100);
                  return `RS${value.toLocaleString()} (${percentage}%)`;
                }
              }
            }
          }
        }
      });
    }

    // Save new transaction
    async function saveTransaction() {
      const amount = parseFloat(document.getElementById("amountInput").value);
      const description = document.getElementById("descriptionInput").value.trim();
      const category = document.getElementById("categoryInput").value.trim();
      const type = document.getElementById("typeInput").value;
      const date = document.getElementById("dateInput").valueAsDate;
      
      // Reset message
      const formMessage = document.getElementById("formMessage");
      formMessage.style.display = "none";
      
      // Validation
      if (!amount || amount <= 0) {
        showFormMessage("Please enter a valid amount", "error");
        return;
      }
      
      if (!category) {
        showFormMessage("Please select a category", "error");
        return;
      }
      
      // Show loading state
      const saveBtn = document.getElementById("saveBtn");
      saveBtn.disabled = true;
      saveBtn.innerHTML = `<span class="loading-spinner"></span> ${translations[currentLanguage].save}`;
      
      try {
        // Add transaction to Firestore
        await db.collection("users").doc(currentUser.uid).collection("transactions").add({
          amount: amount,
          description: description || category,
          category: category,
          type: type,
          date: firebase.firestore.Timestamp.fromDate(date || new Date())
        });
        
        // Show success message
        showFormMessage("Transaction added successfully!", "success");
        
        // Refresh dashboard data
        setTimeout(async () => {
          hideAddModal();
          await loadDashboardData();
        }, 1500);
      } catch (error) {
        console.error("Error adding transaction:", error);
        showFormMessage("Error adding transaction: " + error.message, "error");
      } finally {
        // Reset button
        saveBtn.disabled = false;
        saveBtn.textContent = translations[currentLanguage].save;
      }
    }
    firebase.auth().onAuthStateChanged(async (user) => {
  document.getElementById('loader')?.classList.add('hidden'); // ✅ hide loader
  if (user) {
    // Your logic for signed-in user
  } else {
    // Redirect or show login/register
  }
});

    // Save monthly budget
    async function saveBudget() {
      const budgetInput = document.getElementById("monthlyBudgetInput").value;
      const budgetValue = parseFloat(budgetInput);
      
      if (!budgetValue || budgetValue <= 0) {
        showNotification("Please enter a valid budget amount", "error");
        return;
      }
      
      try {
        // Save budget to Firestore
        await db.collection("users").doc(currentUser.uid).set({
          monthlyBudget: budgetValue
        }, { merge: true });
        
        // Update local variable
        monthlyBudget = budgetValue;
        
        // Update UI
        document.getElementById('totalBudget').textContent = `RS${monthlyBudget.toLocaleString()}`;
        
        // Hide modal
        hideBudgetModal();
        
        // Update dashboard
        updateSummaryCards();
        checkBudgetStatus();
        
        showNotification("Budget updated successfully!", "success");
      } catch (error) {
        console.error("Error saving budget:", error);
        showNotification("Error saving budget: " + error.message, "error");
      }
    }

    // Helper functions
    function getIcon(category) {
      const icons = {
        Food: 'fa-utensils',
        Shopping: 'fa-shopping-bag',
        Transport: 'fa-gas-pump',
        Entertainment: 'fa-film',
        Bills: 'fa-file-invoice',
        Income: 'fa-money-bill-wave',
        Salary: 'fa-briefcase',
        Rent: 'fa-home',
        Travel: 'fa-plane',
        Health: 'fa-heartbeat',
        Groceries: 'fa-apple-whole',
        Others: 'fa-receipt'
      };

      return icons[category] || 'fa-receipt';
    }

    function getIconClass(category) {
      const classes = {
        Food: 'food',
        Shopping: 'shopping',
        Transport: 'transport',
        Entertainment: 'entertainment',
        Bills: 'bills',
        Income: 'income',
        Salary: 'income',
        Rent: 'bills',
        Travel: 'transport',
        Health: 'health',
        Groceries: 'food',
      };

      return classes[category] || 'default-category';
    }

    function showFormMessage(message, type) {
      const formMessage = document.getElementById("formMessage");
      formMessage.textContent = message;
      formMessage.style.display = "block";
      formMessage.style.color = type === "error" ? "var(--danger)" : "var(--success)";
      formMessage.style.backgroundColor = type === "error" ? "rgba(239, 68, 68, 0.1)" : "rgba(16, 185, 129, 0.1)";
    }
    
    function showNotification(message, type) {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      
      // Style based on type
      notification.style.position = 'fixed';
      notification.style.top = '20px';
      notification.style.left = '50%';
      notification.style.transform = 'translateX(-50%)';
      notification.style.padding = '12px 20px';
      notification.style.borderRadius = '8px';
      notification.style.backgroundColor = type === 'error' ? 'rgba(239, 68, 68, 0.9)' : 'rgba(16, 185, 129, 0.9)';
      notification.style.color = 'white';
      notification.style.zIndex = '2000';
      notification.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
      notification.style.fontWeight = '500';
      
      // Add to body
      document.body.appendChild(notification);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }
    
    // Show add modal
    function showAddModal() {
      const modal = document.getElementById("addModal");
      modal.style.display = "flex";
      document.getElementById("formMessage").style.display = "none";
      document.getElementById("amountInput").value = '';
      document.getElementById("descriptionInput").value = '';
      document.getElementById("categoryInput").value = '';
      document.getElementById("typeInput").value = 'expense';
      document.getElementById("dateInput").valueAsDate = new Date();
    }

    // Hide add modal
    function hideAddModal() {
      const modal = document.getElementById("addModal");
      modal.style.display = "none";
    }
    
    // Show budget modal
    function showBudgetModal() {
      const modal = document.getElementById("budgetModal");
      modal.style.display = "flex";
      document.getElementById("monthlyBudgetInput").value = monthlyBudget;
    }
    
    // Hide budget modal
    function hideBudgetModal() {
      const modal = document.getElementById("budgetModal");
      modal.style.display = "none";
    }

    // Logout user
    function logoutUser() {
      auth.signOut().then(() => {
        window.location.href = 'login.html';
      });
    }
    
   function downloadPDF() {
  showNotification(translations[currentLanguage].generating_pdf, "info");

  // Calculate totals
  let totalIncome = 0;
  let totalExpense = 0;

  transactions.forEach(tx => {
    const amount = Number(tx.amount || 0);
    if (tx.type === "income") totalIncome += amount;
    else if (tx.type === "expense") totalExpense += amount;
  });

  const totalBalance = totalIncome - totalExpense;

  // Fill summary values
  document.getElementById('pdfTotalIncome').textContent = `RS${totalIncome.toLocaleString()}`;
  document.getElementById('pdfTotalExpense').textContent = `RS${totalExpense.toLocaleString()}`;
  document.getElementById('pdfTotalBalance').textContent = `RS${totalBalance.toLocaleString()}`;

  // Prepare recent transactions
  const tableBody = document.getElementById('pdfTransactionTable');
  tableBody.innerHTML = '';

  const recentTransactions = transactions
    .map(tx => ({
      ...tx,
      date: tx.date?.toDate ? tx.date.toDate() : new Date(tx.date),
      amount: Number(tx.amount || 0)
    }))
    .sort((a, b) => b.date - a.date)
    .slice(0, 5);

  recentTransactions.forEach(tx => {
    const date = tx.date.toLocaleDateString();
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${date}</td>
      <td>${tx.description || tx.category || ''}</td>
      <td>${tx.category || ''}</td>
      <td>${tx.type || ''}</td>
      <td>RS${tx.amount.toLocaleString()}</td>
    `;
    tableBody.appendChild(row);
  });

  // Generate PDF
  const pdfElement = document.getElementById('pdfContent');
  pdfElement.style.display = 'block';

  const opt = {
    margin: 10,
    filename: 'EasyKharcha_Report.pdf',
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2, useCORS: true },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
  };

  html2pdf().set(opt).from(pdfElement).save()
    .then(() => {
      showNotification(translations[currentLanguage].pdf_downloaded || "PDF downloaded successfully!", "success");
      pdfElement.style.display = 'none';
    })
    .catch(error => {
      showNotification((translations[currentLanguage].pdf_error || "PDF error: ") + error.message, "error");
      pdfElement.style.display = 'none';
    });
}


    
    // Add translations for PDF functionality
    translations.en.generating_pdf = "Generating PDF...";
    translations.en.pdf_downloaded = "PDF downloaded successfully";
    translations.en.pdf_error = "Error generating PDF: ";
    
    translations.ur.generating_pdf = "پی ڈی ایف تیار ہو رہا ہے...";
    translations.ur.pdf_downloaded = "پی ڈی ایف کامیابی سے ڈاؤن لوڈ ہو گیا";
    translations.ur.pdf_error = "پی ڈی ایف بنانے میں خرابی: ";
document.addEventListener('DOMContentLoaded', () => {
  hideAddModal();
  hideBudgetModal();
});

//  Fetch and store in sessionStorage (or localStorage)
db.collection("users").doc(uid).get().then(doc => {
  const userData = doc.data();
  sessionStorage.setItem("userData", JSON.stringify(userData));
  renderUser(userData); // Function to show data in UI
});
// 🔄 Try to load from cache first
let cachedUser = sessionStorage.getItem("userData");
if (cachedUser) {
  renderUser(JSON.parse(cachedUser));
} else {
  // No cache found — fetch from Firestore
  db.collection("users").doc(uid).get().then(doc => {
    const userData = doc.data();
    sessionStorage.setItem("userData", JSON.stringify(userData));
    renderUser(userData);
  });
}
// After profile update
sessionStorage.removeItem("userData"); // Remove old cache
if (!sessionStorage.getItem("userData")) {
  document.getElementById("loader").style.display = "block";
}
async function deleteAllTransactions() {
  if (!confirm("Are you sure you want to permanently delete all transactions?")) return;

  try {
    const batch = db.batch();
    const collectionRef = db.collection("users").doc(currentUser.uid).collection("transactions");

    const snapshot = await collectionRef.get();
    snapshot.forEach(doc => {
      batch.delete(doc.ref);
    });

    await batch.commit();
    showNotification("All transactions deleted!", "success");
    await loadDashboardData();
  } catch (error) {
    console.error("Error deleting all transactions:", error);
    showNotification("Failed to delete all transactions", "error");
  }
}

  </script>
  
  <nav class="bottom-nav">
    <a href="profile.html" class="nav-link">
      <i class="fas fa-user-circle"></i><span data-translate="profile">Profile</span>
    </a>
    <a href="loan.html" class="nav-link active">
      <i class="fas fa-money-bill-wave"></i><span data-translate="loans">Loans</span>
    </a>
    <a href="dashboard.html" class="nav-link">
      <i class="fas fa-chart-pie"></i><span data-translate="dashboard">Dashboard</span>
    </a>
  </nav>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.3/html2pdf.bundle.min.js"></script>
<!-- Chart.js loaded ONCE and deferred -->
<script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<div id="pdfContent" style="display: none;">
  <h2 style="text-align:center;">My Transactions Report</h2>
  <table style="width:100%; border-collapse: collapse;" border="1" cellspacing="0" cellpadding="8">
    <thead>
      <tr>
        <th>Date</th>
        <th>Description</th>
        <th>Category</th>
        <th>Type</th>
        <th>Amount (RS)</th>
      </tr>
    </thead>
    <tbody id="pdfTransactionTable">
      <!-- Filled by JS -->
    </tbody>
  </table>
</div>

<script>
  window.onload = function () {
    if (typeof Android !== "undefined") {
      Android.showDashboardAd(); // Same as profile
    }
  };
</script>

</body>
</html>
