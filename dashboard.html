<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EasyKharcha - Expense Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --secondary: #10b981;
      --accent: #f59e0b;
      --danger: #ef4444;
      --light: #f8fafc;
      --dark: #0f172a;
      --gray: #64748b;
      --card-bg: #ffffff;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s ease;
    }

    body {
      background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
      color: var(--dark);
      min-height: 100vh;
      padding: 16px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Header Styles */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
      margin-bottom: 20px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow);
    }

    .logo-icon i {
      font-size: 24px;
      color: white;
    }

    .logo-text {
      font-size: 24px;
      font-weight: 700;
    }

    .logo-text span {
      color: var(--primary);
    }

    .user-actions {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .notification-btn, .user-profile {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      background: var(--card-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow);
      position: relative;
      cursor: pointer;
    }

    .notification-btn i {
      font-size: 20px;
      color: var(--gray);
    }

    .notification-dot {
      position: absolute;
      top: 3px;
      right: 3px;
      width: 12px;
      height: 12px;
      background: var(--danger);
      border-radius: 50%;
      border: 2px solid var(--card-bg);
    }

    .user-profile img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
    }

    /* Summary Cards */
    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 24px;
      box-shadow: var(--shadow);
      transition: var(--transition);
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .card-title {
      font-size: 16px;
      color: var(--gray);
      font-weight: 500;
    }

    .card-icon {
      width: 48px;
      height: 48px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .card-icon.income {
      background: rgba(16, 185, 129, 0.15);
      color: var(--secondary);
    }

    .card-icon.expense {
      background: rgba(239, 68, 68, 0.15);
      color: var(--danger);
    }

    .card-icon.balance {
      background: rgba(37, 99, 235, 0.15);
      color: var(--primary);
    }

    .card-icon.savings {
      background: rgba(245, 158, 11, 0.15);
      color: var(--accent);
    }

    .card-icon i {
      font-size: 24px;
    }

    .card-value {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .card-change {
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .positive {
      color: var(--secondary);
    }

    .negative {
      color: var(--danger);
    }

    /* Charts and Transactions */
    .dashboard-content {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      margin-bottom: 24px;
    }

    @media (max-width: 768px) {
      .dashboard-content {
        grid-template-columns: 1fr;
      }
    }

    .chart-container {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 24px;
      box-shadow: var(--shadow);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .section-title {
      font-size: 20px;
      font-weight: 600;
    }

    .view-all {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .chart-wrapper {
      height: 300px;
      position: relative;
    }

    .transactions-container {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 24px;
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .transactions-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .transaction-item {
      display: flex;
      align-items: center;
      padding: 16px 0;
      border-bottom: 1px solid rgba(100, 116, 139, 0.1);
    }

    .transaction-icon {
      width: 48px;
      height: 48px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 16px;
    }

    .transaction-icon.food {
      background: rgba(245, 158, 11, 0.15);
      color: var(--accent);
    }

    .transaction-icon.shopping {
      background: rgba(59, 130, 246, 0.15);
      color: #3b82f6;
    }

    .transaction-icon.transport {
      background: rgba(139, 92, 246, 0.15);
      color: #8b5cf6;
    }

    .transaction-icon.entertainment {
      background: rgba(236, 72, 153, 0.15);
      color: #ec4899;
    }

    .transaction-details {
      flex: 1;
    }

    .transaction-title {
      font-weight: 500;
      margin-bottom: 4px;
    }

    .transaction-category {
      font-size: 14px;
      color: var(--gray);
    }

    .transaction-amount {
      font-weight: 600;
    }

    .expense-amount {
      color: var(--danger);
    }

    .income-amount {
      color: var(--secondary);
    }

    /* Categories */
    .categories-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 24px;
    }

    .categories-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .category-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      box-shadow: var(--shadow);
      transition: var(--transition);
      cursor: pointer;
    }

    .category-card:hover {
      transform: translateY(-5px);
    }

    .category-icon {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 12px;
      font-size: 24px;
    }

    .category-name {
      font-weight: 500;
      margin-bottom: 6px;
    }

    .category-amount {
      font-size: 14px;
      color: var(--gray);
    }

    /* Add Transaction Button */
    .add-transaction-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
      cursor: pointer;
      z-index: 100;
      transition: var(--transition);
    }

    .add-transaction-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 25px rgba(37, 99, 235, 0.5);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      header {
        flex-direction: column;
        gap: 16px;
      }

      .logo {
        align-self: flex-start;
      }

      .user-actions {
        align-self: flex-end;
      }
    }

    @media (max-width: 480px) {
      .card {
        padding: 16px;
      }

      .card-value {
        font-size: 24px;
      }

      .chart-container, .transactions-container {
        padding: 16px;
      }

      .transaction-item {
        padding: 12px 0;
      }
    }
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      justify-content: center;
      align-items: center;
      z-index: 1000;
      animation: fadeIn 0.3s ease-in-out;
    }

    .modal-content {
      background: white;
      padding: 24px 30px;
      border-radius: 16px;
      min-width: 300px;
      max-width: 90%;
      width: 400px;
      box-shadow: var(--shadow);
      animation: slideUp 0.3s ease-in-out;
    }

    .modal-content h3 {
      margin-bottom: 16px;
      font-size: 20px;
      text-align: center;
    }

    .modal-content label {
      display: block;
      margin-top: 10px;
      font-weight: 500;
    }

    .modal-content input,
    .modal-content select {
      width: 100%;
      padding: 12px;
      margin-top: 6px;
      border-radius: 12px;
      border: 2px solid var(--light-gray);
      margin-bottom: 10px;
      font-size: 16px;
    }

    .modal-actions {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 20px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      flex: 1;
    }

    .btn-cancel {
      background: #e5e7eb;
      padding: 12px 20px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 500;
      flex: 1;
    }

    @keyframes fadeIn {
      from { opacity: 0 }
      to { opacity: 1 }
    }

    @keyframes slideUp {
      from { transform: translateY(30px); opacity: 0 }
      to { transform: translateY(0); opacity: 1 }
    }
    .transaction-icon.bills {
      background: rgba(100, 116, 139, 0.15);
      color: #64748b;
    }

    .transaction-icon.income {
      background: rgba(16, 185, 129, 0.15);
      color: #10b981;
    }

    .transaction-icon.default-category {
      background: rgba(229, 231, 235, 0.15);
      color: #6b7280;
    }

    .transaction-icon.health {
      background: rgba(244, 63, 94, 0.15);
      color: #f43f5e;
    }

    .transaction-icon.groceries {
      background: rgba(251, 191, 36, 0.15);
      color: #fbbf24;
    }

    .filter-container {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .filter-container select {
      flex: 1;
      min-width: 150px;
      padding: 10px;
      border-radius: 12px;
      border: 2px solid var(--light-gray);
      background: white;
    }

    #formMessage {
      margin-top: 15px;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      font-size: 14px;
      display: none;
    }

    .loading-spinner {
      display: none;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .no-transactions, .no-categories {
      text-align: center;
      padding: 20px;
      color: var(--gray);
      font-style: italic;
    }
    
    .logout-btn {
      background: transparent;
      border: none;
      color: var(--primary);
      cursor: pointer;
      font-weight: 500;
      margin-top: 10px;
      display: block;
      width: 100%;
      text-align: center;
    }
    
    .budget-meter {
      height: 8px;
      background: var(--light-gray);
      border-radius: 4px;
      margin-top: 8px;
      overflow: hidden;
    }
    
    .budget-progress {
      height: 100%;
      background: var(--secondary);
      border-radius: 4px;
    }
    .bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 60px;
  background: #fff;
  border-top: 1px solid #ddd;
  display: flex;
  justify-content: space-around;
  align-items: center;
  z-index: 1000;
  box-shadow: 0 -1px 5px rgba(0,0,0,0.05);
}

.nav-link {
  text-align: center;
  color: #555;
  font-size: 12px;
  flex: 1;
  padding: 5px 0;
  text-decoration: none;
  transition: color 0.3s ease;
}

.nav-link i {
  display: block;
  font-size: 18px;
  margin-bottom: 2px;
}

.nav-link.active {
  color: #004225;
}

.nav-link:hover {
  color: #004225;
}

  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header>
      <div class="logo">
        <div class="logo-icon">
          <i class="fas fa-wallet"></i>
        </div>
        <div class="logo-text">Easy<span>Kharcha</span></div>
      </div>
      <div class="user-actions">
        <div class="notification-btn">
          <i class="fas fa-bell"></i>
          <div class="notification-dot"></div>
        </div>
        <div class="user-profile">
          <img id="userAvatar" src="https://ui-avatars.com/api/?name=User&background=2563eb&color=fff" alt="User">
        </div>
      </div>
    </header>

    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Total Balance</div>
          <div class="card-icon balance">
            <i class="fas fa-wallet"></i>
          </div>
        </div>
        <div class="card-value" id="totalBalance">₹0</div>
        <div class="card-change positive">
          <i class="fas fa-arrow-up"></i> ₹0 (0%)
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Total Income</div>
          <div class="card-icon income">
            <i class="fas fa-arrow-down"></i>
          </div>
        </div>
        <div class="card-value" id="totalIncome">₹0</div>
        <div class="card-change positive">
          <i class="fas fa-arrow-up"></i> ₹0 (0%)
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Total Expense</div>
          <div class="card-icon expense">
            <i class="fas fa-arrow-up"></i>
          </div>
        </div>
        <div class="card-value" id="totalExpense">₹0</div>
        <div class="card-change negative">
          <i class="fas fa-arrow-down"></i> ₹0 (0%)
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Monthly Budget</div>
          <div class="card-icon savings">
            <i class="fas fa-piggy-bank"></i>
          </div>
        </div>
        <div class="card-value" id="totalBudget">₹0</div>
        <div class="budget-meter">
          <div class="budget-progress" id="budgetProgress"></div>
        </div>
      </div>
    </div>

    <!-- Charts and Transactions -->
    <div class="dashboard-content">
      <div class="chart-container">
        <div class="section-header">
          <div class="section-title">Expense Analysis</div>
          <a href="#" class="view-all">View Report <i class="fas fa-chevron-right"></i></a>
        </div>
        <div class="chart-wrapper">
          <canvas id="expenseChart"></canvas>
        </div>
      </div>

      <div class="transactions-container">
        <div class="section-header">
          <div class="section-title">Recent Transactions</div>
          <div class="filter-container">
            <!-- Category Filter -->
            <select id="categoryFilter" required>
              <option value="" selected>All Categories</option>
              <option value="Food">Food</option>
              <option value="Shopping">Shopping</option>
              <option value="Transport">Transport</option>
              <option value="Entertainment">Entertainment</option>
              <option value="Bills">Bills</option>
              <option value="Health">Health</option>
              <option value="Groceries">Groceries</option>
              <option value="Income">Income</option>
            </select>

            <!-- Month Filter -->
            <select id="monthFilter" required>
              <option value="" selected>All Months</option>
              <option value="0">January</option>
              <option value="1">February</option>
              <option value="2">March</option>
              <option value="3">April</option>
              <option value="4">May</option>
              <option value="5">June</option>
              <option value="6">July</option>
              <option value="7">August</option>
              <option value="8">September</option>
              <option value="9">October</option>
              <option value="10">November</option>
              <option value="11">December</option>
            </select>
          </div>
          <a href="#" class="view-all">View All <i class="fas fa-chevron-right"></i></a>
        </div>
        <div class="transactions-list" id="transactionsList">
          <div class="no-transactions">Loading transactions...</div>
        </div>
      </div>
    </div>

    <!-- Expense Categories -->
    <div class="categories-title">Expense Categories</div>
    <div class="categories-grid" id="categoriesGrid">
      <div class="no-categories">Loading categories...</div>
    </div>

    <!-- Add Transaction Button -->
    <div class="add-transaction-btn" id="addTransactionBtn">
      <i class="fas fa-plus"></i>
    </div>
    
    <button class="logout-btn" id="logoutBtn">
      <i class="fas fa-sign-out-alt"></i> Logout
    </button>
  </div>

  <!-- Add Transaction Modal -->
  <div id="addModal" class="modal-overlay">
    <div class="modal-content">
      <h3>Add Transaction</h3>

      <label for="amountInput">Amount (₹)</label>
      <input id="amountInput" type="number" placeholder="Enter amount" required min="0.01" step="0.01" />

      <label for="descriptionInput">Description</label>
      <input id="descriptionInput" type="text" placeholder="e.g. Dinner at Restaurant" />

      <label for="categoryInput">Category</label>
      <select id="categoryInput" required>
        <option value="" disabled selected>Select category</option>
        <option value="Food">Food</option>
        <option value="Shopping">Shopping</option>
        <option value="Transport">Transport</option>
        <option value="Entertainment">Entertainment</option>
        <option value="Bills">Bills</option>
        <option value="Health">Health</option>
        <option value="Groceries">Groceries</option>
        <option value="Income">Income</option>
        <option value="Salary">Salary</option>
        <option value="Rent">Rent</option>
        <option value="Travel">Travel</option>
        <option value="Others">Others</option>
      </select>

      <label for="typeInput">Type</label>
      <select id="typeInput" required>
        <option value="expense">Expense</option>
        <option value="income">Income</option>
      </select>

      <label for="dateInput">Date</label>
      <input id="dateInput" type="date" required />

      <div class="modal-actions">
        <button id="cancelBtn" class="btn-cancel">Cancel</button>
        <button id="saveBtn" class="btn-primary">Save</button>
      </div>
      <div id="formMessage"></div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDHGd2EAJVUUYXa50G65GkutoiiHz9qtn8",
      authDomain: "easykharcha.firebaseapp.com",
      projectId: "easykharcha",
      storageBucket: "easykharcha.firebasestorage.app",
      messagingSenderId: "735642025618",
      appId: "1:735642025618:web:eacc16213b61c48c93f04b",
      measurementId: "G-JF3E4QMZQN"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    
    // Global variables
    let expenseChart = null;
    let currentUser = null;
    let transactions = [];
    let monthlyBudget = 30000; // Default monthly budget

    // Initialize the dashboard when page loads
    document.addEventListener('DOMContentLoaded', () => {
      // Check if elements exist before attaching event listeners
      if (document.getElementById('categoryFilter')) {
        document.getElementById('categoryFilter').addEventListener('change', renderTransactions);
      }
      
      if (document.getElementById('monthFilter')) {
        document.getElementById('monthFilter').addEventListener('change', renderTransactions);
      }
      
      if (document.getElementById('addTransactionBtn')) {
        document.getElementById('addTransactionBtn').addEventListener('click', showAddModal);
      }
      
      if (document.getElementById('logoutBtn')) {
        document.getElementById('logoutBtn').addEventListener('click', logoutUser);
      }
      
      // Setup modal buttons only if elements exist
      if (document.getElementById('saveBtn')) {
        document.getElementById('saveBtn').addEventListener('click', saveTransaction);
      }
      
      if (document.getElementById('cancelBtn')) {
        document.getElementById('cancelBtn').addEventListener('click', hideAddModal);
      }
      
      // Initialize Firebase auth state listener
      auth.onAuthStateChanged(user => {
        if (user) {
          currentUser = user;
          document.getElementById('userAvatar').src = `https://ui-avatars.com/api/?name=${user.displayName || user.email}&background=2563eb&color=fff`;
          loadDashboardData();
        } else {
          // Redirect to login if not authenticated
          window.location.href = 'login.html';
        }
      });
    });

    // Show add modal
    function showAddModal() {
      const modal = document.getElementById("addModal");
      if (modal) {
        modal.style.display = "flex";
        document.getElementById("formMessage").style.display = "none";
        document.getElementById("amountInput").value = '';
        document.getElementById("descriptionInput").value = '';
        document.getElementById("categoryInput").value = '';
        document.getElementById("typeInput").value = 'expense';
        document.getElementById("dateInput").valueAsDate = new Date();
      }
    }

    // Hide add modal
    function hideAddModal() {
      const modal = document.getElementById("addModal");
      if (modal) modal.style.display = "none";
    }

    // Logout user
    function logoutUser() {
      auth.signOut().then(() => {
        window.location.href = 'login.html';
      });
    }

    // Load all dashboard data
    async function loadDashboardData() {
      try {
        // Load user preferences
        await loadUserPreferences();
        
        // Load transactions
        await loadTransactions();
        
        // Update summary cards
        updateSummaryCards();
        
        // Update categories grid
        updateCategoriesGrid();
        
        // Initialize the chart
        initExpenseChart();
      } catch (error) {
        console.error("Error loading dashboard data:", error);
        showNotification("Error loading dashboard data. Please try again.", "error");
      }
    }

    // Load user preferences
    async function loadUserPreferences() {
      try {
        const doc = await db.collection("users").doc(currentUser.uid).get();
        if (doc.exists) {
          const data = doc.data();
          monthlyBudget = data.monthlyBudget || 30000;
          document.getElementById('totalBudget').textContent = `₹${monthlyBudget.toLocaleString()}`;
        }
      } catch (error) {
        console.error("Error loading user preferences:", error);
      }
    }

    // Load transactions from Firestore
    async function loadTransactions() {
      try {
        const snapshot = await db.collection("users").doc(currentUser.uid).collection("transactions")
          .orderBy("date", "desc")
          .limit(50)
          .get();
        
        transactions = [];
        snapshot.forEach(doc => {
          const data = doc.data();
          transactions.push({
            id: doc.id,
            ...data,
            // Convert Firestore Timestamp to Date if needed
            date: data.date.toDate ? data.date.toDate() : data.date
          });
        });
        
        renderTransactions();
      } catch (error) {
        console.error("Error loading transactions:", error);
        showNotification("Error loading transactions. Please try again.", "error");
      }
    }

    // Render transactions based on filters
    function renderTransactions() {
      const transactionsList = document.getElementById('transactionsList');
      if (!transactionsList) return;
      
      transactionsList.innerHTML = '';
      
      if (transactions.length === 0) {
        transactionsList.innerHTML = '<div class="no-transactions">No transactions found</div>';
        return;
      }
      
      const selectedCategory = document.getElementById('categoryFilter').value;
      const selectedMonth = document.getElementById('monthFilter').value;
      
      const filteredTransactions = transactions.filter(transaction => {
        // Filter by category
        if (selectedCategory && transaction.category !== selectedCategory) {
          return false;
        }
        
        // Filter by month
        if (selectedMonth !== "") {
          const transactionDate = transaction.date;
          if (transactionDate.getMonth() != selectedMonth) {
            return false;
          }
        }
        
        return true;
      });
      
      if (filteredTransactions.length === 0) {
        transactionsList.innerHTML = '<div class="no-transactions">No transactions match the filters</div>';
        return;
      }
      
      filteredTransactions.forEach(transaction => {
        const transactionDate = transaction.date;
        const formattedDate = `${transactionDate.getDate()} ${transactionDate.toLocaleString('default', { month: 'short' })}`;
        
        const typeClass = transaction.type === "income" ? "income-amount" : "expense-amount";
        const iconClass = getIconClass(transaction.category);
        const icon = getIcon(transaction.category);
        
        const transactionItem = document.createElement('div');
        transactionItem.className = 'transaction-item';
        transactionItem.innerHTML = `
          <div class="transaction-icon ${iconClass}">
            <i class="fas ${icon}"></i>
          </div>
          <div class="transaction-details">
            <div class="transaction-title">${transaction.description || transaction.category}</div>
            <div class="transaction-category">${transaction.category} • ${formattedDate}</div>
          </div>
          <div class="transaction-amount ${typeClass}">${transaction.type === 'income' ? '+' : '-'}₹${transaction.amount.toLocaleString()}</div>
        `;
        transactionsList.appendChild(transactionItem);
      });
    }

    // Update summary cards with real data
    function updateSummaryCards() {
      let totalIncome = 0;
      let totalExpense = 0;
      let currentMonthExpense = 0;
      const currentMonth = new Date().getMonth();
      
      transactions.forEach(transaction => {
        if (transaction.type === "income") {
          totalIncome += transaction.amount;
        } else if (transaction.type === "expense") {
          totalExpense += transaction.amount;
          
          // Calculate current month expense
          if (transaction.date.getMonth() === currentMonth) {
            currentMonthExpense += transaction.amount;
          }
        }
      });
      
      const totalBalance = totalIncome - totalExpense;
      
      // Update budget progress
      const budgetProgress = document.getElementById('budgetProgress');
      if (budgetProgress) {
        const progressPercent = Math.min((currentMonthExpense / monthlyBudget) * 100, 100);
        budgetProgress.style.width = `${progressPercent}%`;
        budgetProgress.style.background = progressPercent > 80 ? 
          (progressPercent > 95 ? 'var(--danger)' : 'var(--accent)') : 'var(--secondary)';
      }
      
      document.getElementById('totalBalance').textContent = `₹${totalBalance.toLocaleString()}`;
      document.getElementById('totalIncome').textContent = `₹${totalIncome.toLocaleString()}`;
      document.getElementById('totalExpense').textContent = `₹${totalExpense.toLocaleString()}`;
    }

    // Update categories grid with real data
    function updateCategoriesGrid() {
      const categoriesGrid = document.getElementById('categoriesGrid');
      if (!categoriesGrid) return;
      
      categoriesGrid.innerHTML = '';
      
      const categories = {};
      const currentMonth = new Date().getMonth();
      
      // Aggregate expenses by category for current month
      transactions.forEach(transaction => {
        if (transaction.type === "expense" && transaction.date.getMonth() === currentMonth) {
          const category = transaction.category;
          categories[category] = (categories[category] || 0) + transaction.amount;
        }
      });
      
      const categoryList = Object.entries(categories);
      if (categoryList.length === 0) {
        categoriesGrid.innerHTML = '<div class="no-categories">No expenses this month</div>';
        return;
      }
      
      // Sort categories by amount (descending)
      categoryList.sort((a, b) => b[1] - a[1]);
      
      categoryList.forEach(([category, amount]) => {
        const icon = getIcon(category);
        const iconClass = getIconClass(category);
        const formattedAmount = `₹${amount.toLocaleString()}`;
        
        const categoryCard = document.createElement('div');
        categoryCard.className = 'category-card';
        categoryCard.innerHTML = `
          <div class="category-icon ${iconClass}">
            <i class="fas ${icon}"></i>
          </div>
          <div class="category-name">${category}</div>
          <div class="category-amount">${formattedAmount}</div>
        `;
        categoriesGrid.appendChild(categoryCard);
      });
    }

    // Initialize expense chart
    function initExpenseChart() {
      const ctx = document.getElementById('expenseChart');
      if (!ctx) return;
      
      // Destroy previous chart if exists
      if (expenseChart) {
        expenseChart.destroy();
      }
      
      // Prepare data for the chart
      const categories = {};
      const currentMonth = new Date().getMonth();
      
      // Aggregate expenses by category for current month
      transactions.forEach(transaction => {
        if (transaction.type === "expense" && transaction.date.getMonth() === currentMonth) {
          const category = transaction.category;
          categories[category] = (categories[category] || 0) + transaction.amount;
        }
      });
      
      const categoryNames = Object.keys(categories);
      const categoryAmounts = Object.values(categories);
      
      // Create chart
      expenseChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: categoryNames,
          datasets: [{
            data: categoryAmounts,
            backgroundColor: [
              'rgba(245, 158, 11, 0.7)',
              'rgba(59, 130, 246, 0.7)',
              'rgba(139, 92, 246, 0.7)',
              'rgba(236, 72, 153, 0.7)',
              'rgba(16, 185, 129, 0.7)',
              'rgba(239, 68, 68, 0.7)',
              'rgba(251, 191, 36, 0.7)',
              'rgba(101, 163, 13, 0.7)',
              'rgba(234, 88, 12, 0.7)',
              'rgba(124, 58, 237, 0.7)'
            ],
            borderWidth: 1,
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const value = context.parsed || 0;
                  const total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                  const percentage = Math.round((value / total) * 100);
                  return `₹${value.toLocaleString()} (${percentage}%)`;
                }
              }
            }
          }
        }
      });
    }

    // Save new transaction
    async function saveTransaction() {
      const amount = parseFloat(document.getElementById("amountInput").value);
      const description = document.getElementById("descriptionInput").value.trim();
      const category = document.getElementById("categoryInput").value.trim();
      const type = document.getElementById("typeInput").value;
      const date = document.getElementById("dateInput").valueAsDate;
      
      // Reset message
      const formMessage = document.getElementById("formMessage");
      formMessage.style.display = "none";
      
      // Validation
      if (!amount || amount <= 0) {
        showFormMessage("Please enter a valid amount", "error");
        return;
      }
      
      if (!category) {
        showFormMessage("Please select a category", "error");
        return;
      }
      
      // Show loading state
      const saveBtn = document.getElementById("saveBtn");
      saveBtn.disabled = true;
      saveBtn.innerHTML = '<span class="loading-spinner"></span> Saving...';
      
      try {
        // Add transaction to Firestore
        await db.collection("users").doc(currentUser.uid).collection("transactions").add({
          amount: amount,
          description: description || category,
          category: category,
          type: type,
          date: firebase.firestore.Timestamp.fromDate(date || new Date())
        });
        
        // Show success message
        showFormMessage("Transaction added successfully!", "success");
        
        // Refresh dashboard data
        setTimeout(async () => {
          hideAddModal();
          await loadDashboardData();
        }, 1500);
      } catch (error) {
        console.error("Error adding transaction:", error);
        showFormMessage("Error adding transaction: " + error.message, "error");
      } finally {
        // Reset button
        saveBtn.disabled = false;
        saveBtn.textContent = 'Save';
      }
    }

    // Helper functions
    function getIcon(category) {
      const icons = {
        Food: 'fa-utensils',
        Shopping: 'fa-shopping-bag',
        Transport: 'fa-gas-pump',
        Entertainment: 'fa-film',
        Bills: 'fa-file-invoice',
        Income: 'fa-money-bill-wave',
        Salary: 'fa-briefcase',
        Rent: 'fa-home',
        Travel: 'fa-plane',
        Health: 'fa-heartbeat',
        Groceries: 'fa-apple-whole',
        Others: 'fa-receipt'
      };

      return icons[category] || 'fa-receipt';
    }

    function getIconClass(category) {
      const classes = {
        Food: 'food',
        Shopping: 'shopping',
        Transport: 'transport',
        Entertainment: 'entertainment',
        Bills: 'bills',
        Income: 'income',
        Salary: 'income',
        Rent: 'bills',
        Travel: 'transport',
        Health: 'health',
        Groceries: 'food',
      };

      return classes[category] || 'default-category';
    }

    function showFormMessage(message, type) {
      const formMessage = document.getElementById("formMessage");
      if (!formMessage) return;
      
      formMessage.textContent = message;
      formMessage.style.display = "block";
      formMessage.style.color = type === "error" ? "var(--danger)" : "var(--success)";
      formMessage.style.backgroundColor = type === "error" ? "rgba(239, 68, 68, 0.1)" : "rgba(16, 185, 129, 0.1)";
    }
    
    function showNotification(message, type) {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      
      // Add to body
      document.body.appendChild(notification);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }
  </script>
  <nav class="bottom-nav">
  <a href="dashboard.html" class="nav-link">
    <i class="fas fa-home"></i><span>Dashboard</span>
  </a>
  <a href="loan.html" class="nav-link active">
    <i class="fas fa-money-bill-wave"></i><span>Loan</span>
  </a>
  <a href="profile.html" class="nav-link">
    <i class="fas fa-user-circle"></i><span>Profile</span>
  </a>
</nav>

</body>
</html>